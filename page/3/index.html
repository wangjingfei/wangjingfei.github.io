<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2016-08-14-how-to-support-full-unicode-in-mysql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-14-how-to-support-full-unicode-in-mysql/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-14-how-to-support-full-unicode-in-mysql/">How to support full Unicode in MySQL databases</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å¦‚æœä½ å®Œå…¨ä»å¤´å»ºç«‹ä¸€ä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆäº‹æƒ…ç®€å•äº†å¾ˆå¤šï¼Œç›´æ¥å‚è€ƒï¼š<a href="/2016/08/14/create-mysql-database-with-utf8mb4.html">åˆ›å»ºæ”¯æŒemojiè¡¨æƒ…çš„MySQLæ•°æ®åº“ï¼ˆutf8mb4ï¼‰</a>ã€‚</p>
<p>å¦‚æœä½ çš„æ•°æ®åº“å·²ç»åœ¨æŠ•å…¥ä½¿ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥å‚è€ƒæ–‡ç« çš„ä»¥ä¸‹éƒ¨åˆ†ã€‚</p>
<blockquote>
<p><strong>Reference:</strong> <a target="_blank" rel="noopener" href="https://mathiasbynens.be/notes/mysql-utf8mb4">https://mathiasbynens.be/notes/mysql-utf8mb4</a></p>
</blockquote>
<h2 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h2><p><a target="_blank" rel="noopener" href="https://encoding.spec.whatwg.org/#utf-8">The UTF-8 encoding</a> can represent every symbol in the Unicode character set, which ranges from <code>U+000000</code> to <code>U+10FFFF</code>. Thatâ€™s 1,114,112 possible symbols. (Not all of these Unicode code points have been assigned characters yet, but that doesnâ€™t stop UTF-8 from being able to encode them.)</p>
<p>UTF-8 is a variable-width encoding; it encodes each symbol using <strong>one to four 8-bit bytes</strong>. Symbols with lower numerical code point values are encoded using fewer bytes. This way, UTF-8 is optimized for the common case where ASCII characters and other <a target="_blank" rel="noopener" href="https://mathiasbynens.be/notes/javascript-encoding#bmp">BMP symbols</a> (whose code points range from <code>U+000000</code> to <code>U+00FFFF</code>) are used â€” while still allowing astral symbols (whose code points range from <code>U+010000</code> to <code>U+10FFFF</code>) to be stored.</p>
<h2 id="MySQLâ€™s-utf8"><a href="#MySQLâ€™s-utf8" class="headerlink" title="MySQLâ€™s utf8"></a>MySQLâ€™s <code>utf8</code></h2><p>MySQLâ€™s utf8 charset only partially implements proper UTF-8 encoding. It can only store UTF-8-encoded symbols that consist of one to three bytes; encoded symbols that take up four bytes arenâ€™t supported.</p>
<p>Since astral symbols (whose code points range from U+010000 to U+10FFFF) each consist of four bytes in UTF-8, you cannot store them using MySQLâ€™s utf8 implementation. And if you are doing so, youâ€™ll get the following warning:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW WARNINGS;</span><br><span class="line">+---------+------+------------------------------------------------------------------------------+</span><br><span class="line">| Level   | Code | Message                                                                      |</span><br><span class="line">+---------+------+------------------------------------------------------------------------------+</span><br><span class="line">| Warning | 1366 | Incorrect string value: &#39;\xF0\x9D\x8C\x86&#39; for column &#39;column_name&#39; at row 1 |</span><br><span class="line">+---------+------+------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>this behavior can lead to data loss, but it gets worse â€” it can result in security vulnerabilities. Here are some examples, all of which were discovered after publishing this write-up:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://tom.vg/2013/09/wordpress-php-object-injection/">PHP object injection vulnerability in WordPress &lt; 3.6.1</a>, leading to <a target="_blank" rel="noopener" href="https://tom.vg/2013/12/wordpress-rce-exploit/">remote code execution in combination with certain WordPress plugins</a></li>
<li><a target="_blank" rel="noopener" href="https://hackerone.com/reports/2233">Email authentication bypass in Phabricator</a></li>
<li><a target="_blank" rel="noopener" href="https://cedricvb.be/post/wordpress-stored-xss-vulnerability-4-1-2/">Stored XSS in WordPress 4.1.2</a></li>
<li><a target="_blank" rel="noopener" href="https://www.reddit.com/r/netsec/comments/3wt0yk/critical_0day_remote_command_execution/cxz2qtc">Remote command execution in the Joomla! CMS</a></li>
</ol>
<p>MySQLâ€™s <code>utf8</code> encoding is awkwardly named, as itâ€™s different from proper UTF-8 encoding. It doesnâ€™t offer full Unicode support, which can lead to data loss or security vulnerabilities.</p>
<h2 id="MySQLâ€™s-utf8mb4"><a href="#MySQLâ€™s-utf8mb4" class="headerlink" title="MySQLâ€™s utf8mb4"></a>MySQLâ€™s <code>utf8mb4</code></h2><p>Luckily, <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/relnotes/mysql/5.5/en/news-5-5-3.html">MySQL 5.5.3 (released in early 2010)</a> introduced a new encoding called utf8mb4 which maps to proper UTF-8 and thus fully supports Unicode, including astral symbols.</p>
<h3 id="Switching-from-MySQLâ€™s-utf8-to-utf8mb4"><a href="#Switching-from-MySQLâ€™s-utf8-to-utf8mb4" class="headerlink" title="Switching from MySQLâ€™s utf8 to utf8mb4"></a>Switching from MySQLâ€™s <code>utf8</code> to <code>utf8mb4</code></h3><p><strong>Step 1: Create a backup</strong></p>
<p>Create a backup of all the databases on the server you want to upgrade. Safety first!</p>
<p><strong>Step 2: Upgrade the MySQL server</strong></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">Upgrade the MySQL server to v5.5.3+</a>, or ask your server administrator to do it for you.</p>
<p><strong>Step 3: Modify databases, tables, and columns</strong></p>
<p>Change the character set and collation properties of the databases, tables, and columns to use <code>utf8mb4</code> instead of <code>utf8</code>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">For</span> <span class="keyword">each</span> database:</span><br><span class="line"><span class="keyword">ALTER</span> DATABASE database_name <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_unicode_ci;</span><br><span class="line"># <span class="keyword">For</span> <span class="keyword">each</span> <span class="keyword">table</span>:</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"># <span class="keyword">For</span> <span class="keyword">each</span> <span class="keyword">column</span>:</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name CHANGE column_name column_name <span class="type">VARCHAR</span>(<span class="number">191</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"># (Donâ€™t blindly <span class="keyword">copy</span><span class="operator">-</span>paste this<span class="operator">!</span> The exact statement depends <span class="keyword">on</span> the <span class="keyword">column</span> type, maximum length, <span class="keyword">and</span> other properties. The above line <span class="keyword">is</span> just an example <span class="keyword">for</span> a `<span class="type">VARCHAR</span>` column.)</span><br></pre></td></tr></table></figure>
<p>Since <code>utf8mb4</code> is fully backwards compatible with <code>utf8</code>, no mojibake or other forms of data loss should occur. (But you have a backup, right?)</p>
<p><strong>Step 4: Check the maximum length of columns and index keys</strong></p>
<p>This is probably the most tedious part of the whole upgrading process.</p>
<p>When converting from <code>utf8</code> to <code>utf8mb4</code>, the maximum length of a column or index key is unchanged in terms of bytes. Therefore, it is smaller in terms of characters, because the maximum length of a character is now four bytes instead of three.</p>
<p>For example, a <code>TINYTEXT</code> column can hold up to 255 bytes, which correlates to 85 three-byte or 63 four-byte characters. Letâ€™s say you have a <code>TINYTEXT</code> column that uses <code>utf8</code> but must be able to contain more than 63 characters. Given this requirement, you canâ€™t convert this column to <code>utf8mb4</code> unless you also change the data type to a longer type such as <code>TEXT</code> â€” because if youâ€™d try to fill it with four-byte characters, youâ€™d only be able to enter 63 characters, but not more.</p>
<p>The same goes for index keys. The InnoDB storage engine has a maximum index length of 767 bytes, so for <code>utf8</code> or <code>utf8mb4</code> columns, you can index a maximum of 255 or 191 characters, respectively. If you currently have <code>utf8</code> columns with indexes longer than 191 characters, you will need to index a smaller number of characters when using <code>utf8mb4</code>. (Because of this, I had to change some indexed VARCHAR(255) columns to VARCHAR(191).)</p>
<p><strong>Step 5: Modify connection, client, and server character sets</strong></p>
<p>In your application code, set the connection character set to utf8mb4. This can be done by simply replacing any variants of <code>SET NAMES utf8</code> with <code>SET NAMES utf8mb4</code>. If your old <code>SET NAMES</code> statement specified the collation, make sure to change that as well, e.g. <code>SET NAMES utf8 COLLATE utf8_unicode_ci</code> becomes <code>SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci</code>.</p>
<p>Make sure to set the client and server character set as well. I have the following in my MySQL configuration file (/etc/my.cnf):</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="attr">default-character-set</span> = utf8mb4</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character-set-client-handshake</span> = <span class="literal">FALSE</span></span><br><span class="line"><span class="attr">character-set-server</span> = utf8mb4</span><br><span class="line"><span class="attr">collation-server</span> = utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure>

<p>You can easily confirm these settings work correctly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES WHERE Variable_name LIKE &#39;character\_set\_%&#39; OR Variable_name LIKE &#39;collation%&#39;;</span><br><span class="line">+--------------------------+--------------------+</span><br><span class="line">| Variable_name            | Value              |</span><br><span class="line">+--------------------------+--------------------+</span><br><span class="line">| character_set_client     | utf8mb4            |</span><br><span class="line">| character_set_connection | utf8mb4            |</span><br><span class="line">| character_set_database   | utf8mb4            |</span><br><span class="line">| character_set_filesystem | binary             |</span><br><span class="line">| character_set_results    | utf8mb4            |</span><br><span class="line">| character_set_server     | utf8mb4            |</span><br><span class="line">| character_set_system     | utf8               |</span><br><span class="line">| collation_connection     | utf8mb4_unicode_ci |</span><br><span class="line">| collation_database       | utf8mb4_unicode_ci |</span><br><span class="line">| collation_server         | utf8mb4_unicode_ci |</span><br><span class="line">+--------------------------+--------------------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>As you can see, all the relevant options are set to utf8mb4, except for <code>character_set_filesystem</code> which should be binary unless youâ€™re on a file system that supports multi-byte UTF-8-encoded characters in file names, and <code>character_set_system</code> which is always utf8 and canâ€™t be overridden.</p>
<p><strong>Step 6: Repair and optimize all tables</strong></p>
<p>You only need this when you meet some wired bugs. The details are in the reference: <a target="_blank" rel="noopener" href="https://mathiasbynens.be/notes/mysql-utf8mb4">How to support full Unicode in MySQL databases</a></p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Never use <code>utf8</code> in MySQL â€” always use <code>utf8mb4</code> instead. Updating your databases and code might take some time, but itâ€™s definitely worth the effort. Why would you arbitrarily limit the set of symbols that can be used in your database? Why would you lose data every time a user enters an astral symbol as part of a comment or message or whatever it is you store in your database? Thereâ€™s no reason not to strive for full Unicode support everywhere. Do the right thing, and use utf8mb4. ğŸ»</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-14-how-to-support-full-unicode-in-mysql/" data-id="cklf7tst6001iz8t4c98ocb7w" data-title="How to support full Unicode in MySQL databases" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Emoji/" rel="tag">Emoji</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utf8mb4/" rel="tag">utf8mb4</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-14-linux-commands" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-14-linux-commands/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-14-linux-commands/">Linuxå¸¸ç”¨å‘½ä»¤</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>æ³¨æ„ï¼š</strong>å¸¸ç”¨å‘½ä»¤ä¸­ï¼Œä¼šæœ‰ä¸€äº›å‘½ä»¤ä»…é™äºç‰¹å®šçš„æ“ä½œç³»ç»Ÿä½¿ç”¨ï¼Œå¦‚Ubuntuæˆ–CentOSç­‰ç‰¹å®šçš„Linuxå‘è¡Œç‰ˆæœ¬ã€‚</p>
<h2 id="ç³»ç»Ÿç›¸å…³"><a href="#ç³»ç»Ÿç›¸å…³" class="headerlink" title="ç³»ç»Ÿç›¸å…³"></a>ç³»ç»Ÿç›¸å…³</h2><h3 id="æ˜¾ç¤ºå½“å‰å†…æ ¸ç‰ˆæœ¬"><a href="#æ˜¾ç¤ºå½“å‰å†…æ ¸ç‰ˆæœ¬" class="headerlink" title="æ˜¾ç¤ºå½“å‰å†…æ ¸ç‰ˆæœ¬"></a>æ˜¾ç¤ºå½“å‰å†…æ ¸ç‰ˆæœ¬</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-PC:~$ uname -a</span><br><span class="line">Linux fify-PC 4.4.0-31-generic #50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure>

<h3 id="æ˜¾ç¤ºå½“å‰Ubuntuçš„ç³»ç»Ÿç‰ˆæœ¬"><a href="#æ˜¾ç¤ºå½“å‰Ubuntuçš„ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="æ˜¾ç¤ºå½“å‰Ubuntuçš„ç³»ç»Ÿç‰ˆæœ¬"></a>æ˜¾ç¤ºå½“å‰Ubuntuçš„ç³»ç»Ÿç‰ˆæœ¬</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-PC:~$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu 16.04.1 LTS</span><br><span class="line">Release:        16.04</span><br><span class="line">Codename:       xenial</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨æˆ·å’Œç»„"><a href="#ç”¨æˆ·å’Œç»„" class="headerlink" title="ç”¨æˆ·å’Œç»„"></a>ç”¨æˆ·å’Œç»„</h2><h3 id="æ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·å"><a href="#æ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·å" class="headerlink" title="æ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·å"></a>æ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·å</h3><p>å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-PC:~$ whoami</span><br><span class="line">fify</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‘½ä»¤åœ¨ç»„åˆå…¶ä»–å‘½ä»¤ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ä¼šæ¯”è¾ƒå¥½ç”¨ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $(whoami)</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹ç”¨æˆ·æ‰€å±çš„ç»„"><a href="#æŸ¥çœ‹ç”¨æˆ·æ‰€å±çš„ç»„" class="headerlink" title="æŸ¥çœ‹ç”¨æˆ·æ‰€å±çš„ç»„"></a>æŸ¥çœ‹ç”¨æˆ·æ‰€å±çš„ç»„</h3><p>å¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ç»„æˆ–è€…æŒ‡å®šç”¨æˆ·æ‰€å±çš„ç»„ã€‚</p>
<h4 id="æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å±çš„ç»„"><a href="#æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å±çš„ç»„" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å±çš„ç»„"></a>æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€å±çš„ç»„</h4><p>å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groups</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-PC:~$ groups</span><br><span class="line">fify adm cdrom sudo dip plugdev lpadmin sambashare</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ‰€å±çš„ç»„"><a href="#æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ‰€å±çš„ç»„" class="headerlink" title="æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ‰€å±çš„ç»„"></a>æŸ¥çœ‹å…¶ä»–ç”¨æˆ·æ‰€å±çš„ç»„</h4><p>å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groups fify</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-PC:~$ groups fify</span><br><span class="line">fify : fify adm cdrom sudo dip plugdev lpadmin sambashare docker</span><br></pre></td></tr></table></figure>

<h4 id="ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œå‘½ä»¤"><a href="#ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œå‘½ä»¤" class="headerlink" title="ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œå‘½ä»¤"></a>ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œå‘½ä»¤</h4><p>ä»¥ä¸‹å‘½ä»¤ä»¥jenkinsç”¨æˆ·çš„èº«ä»½æ‰§è¡Œ<code>jstack 36730</code>å‘½ä»¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u jenkins -H jstack 36730</span><br></pre></td></tr></table></figure>

<h2 id="å®ç”¨å·¥å…·"><a href="#å®ç”¨å·¥å…·" class="headerlink" title="å®ç”¨å·¥å…·"></a>å®ç”¨å·¥å…·</h2><h3 id="æ–‡å­—å¤„ç†"><a href="#æ–‡å­—å¤„ç†" class="headerlink" title="æ–‡å­—å¤„ç†"></a>æ–‡å­—å¤„ç†</h3><h4 id="æ›¿æ¢æŸè¡Œä¸­é—´çš„æ–‡å­—"><a href="#æ›¿æ¢æŸè¡Œä¸­é—´çš„æ–‡å­—" class="headerlink" title="æ›¿æ¢æŸè¡Œä¸­é—´çš„æ–‡å­—"></a>æ›¿æ¢æŸè¡Œä¸­é—´çš„æ–‡å­—</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/\(.*\)wrapper.daemonize=FALSE\(.*\)/\1wrapper.daemonize=TRUE\2/g&#x27;</span> -i mycat</span><br></pre></td></tr></table></figure>
<p>æ›¿æ¢mycatæ–‡ä»¶ä¸­åŒ…å«<code>wrapper.daemonize=FALSE</code>çš„è¡Œï¼Œå¹¶æŠŠ<code>wrapper.daemonize=FALSE</code>æ›¿æ¢ä¸º<code>wrapper.daemonize=TRUE</code>ã€‚</p>
<h4 id="æŸ¥çœ‹æ–‡ä»¶çš„ç¬¬m-nè¡Œ"><a href="#æŸ¥çœ‹æ–‡ä»¶çš„ç¬¬m-nè¡Œ" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶çš„ç¬¬m-nè¡Œ"></a>æŸ¥çœ‹æ–‡ä»¶çš„ç¬¬m-nè¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;5,10p&#x27;</span> filename</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä½ å°±å¯ä»¥åªæŸ¥çœ‹æ–‡ä»¶çš„ç¬¬5è¡Œåˆ°ç¬¬10è¡Œã€‚</p>
<h4 id="åˆ é™¤æ–‡ä»¶çš„æŸä¸€è¡Œ"><a href="#åˆ é™¤æ–‡ä»¶çš„æŸä¸€è¡Œ" class="headerlink" title="åˆ é™¤æ–‡ä»¶çš„æŸä¸€è¡Œ"></a>åˆ é™¤æ–‡ä»¶çš„æŸä¸€è¡Œ</h4><p>åˆ é™¤æ–‡ä»¶çš„ç¬¬ä¸‰è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;3d&#x27;</span> 1.txt</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤æ–‡ä»¶çš„ç¬¬ä¸‰è‡³ç¬¬äº”è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;3,5d&#x27;</span> 1.txt</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤ç¬¦åˆç‰¹å®šæ­£åˆ™è¡¨è¾¾å¼çš„è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/^Love/d&#x27;</span> 1.txt</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨sedæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸­ä½¿ç”¨Lazyç­–ç•¥ï¼š"><a href="#åœ¨sedæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸­ä½¿ç”¨Lazyç­–ç•¥ï¼š" class="headerlink" title="åœ¨sedæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸­ä½¿ç”¨Lazyç­–ç•¥ï¼š"></a>åœ¨<code>sed</code>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ä¸­ä½¿ç”¨Lazyç­–ç•¥ï¼š</h4><p><code>sed</code>å‘½ä»¤çš„æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸æ”¯æŒæ‡’åŒ¹é…ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»•è¿‡çš„æ–¹æ³•æ¥åšã€‚æ¯”å¦‚æˆ‘è¦æŸ¥æ‰¾ä»¥ä¸‹å†…å®¹ä¸­â€å’Œâ€ä¹‹é—´çš„å•è¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;departmentId&quot; bigint(20) NOT NULL,</span><br><span class="line">&quot;departmentName&quot; varchar(128) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span><br><span class="line">&quot;monthly&quot; varchar(10) COLLATE utf8mb4_unicode_ci NOT NULL,</span><br><span class="line">&quot;positionName&quot; varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,</span><br><span class="line">&quot;staffId&quot; varchar(40) COLLATE utf8mb4_unicode_ci NOT NULL,</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡`â€[^&quot;]*â€æŸ¥æ‰¾â€â€ä¹‹é—´çš„å†…å®¹ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/&quot;\([^&quot;]*\)&quot;[^,]*,/\1,/g&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è·å–åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;departmentId&quot;,</span><br><span class="line">&quot;departmentName&quot;,</span><br><span class="line">&quot;monthly&quot;,</span><br><span class="line">&quot;positionName&quot;,</span><br><span class="line">&quot;staffId&quot;,</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶å·¥å…·"><a href="#æ–‡ä»¶å·¥å…·" class="headerlink" title="æ–‡ä»¶å·¥å…·"></a>æ–‡ä»¶å·¥å…·</h3><h4 id="è·å–ç›®å½•ä¸­æœ€æ–°çš„æ–‡ä»¶"><a href="#è·å–ç›®å½•ä¸­æœ€æ–°çš„æ–‡ä»¶" class="headerlink" title="è·å–ç›®å½•ä¸­æœ€æ–°çš„æ–‡ä»¶"></a>è·å–ç›®å½•ä¸­æœ€æ–°çš„æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls *.war -Art | tail -n 1</span><br></pre></td></tr></table></figure>

<h4 id="æŸ¥çœ‹æ–‡ä»¶ç±»å‹"><a href="#æŸ¥çœ‹æ–‡ä»¶ç±»å‹" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶ç±»å‹"></a>æŸ¥çœ‹æ–‡ä»¶ç±»å‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file xxxx.jpg</span><br></pre></td></tr></table></figure>

<p><code>file</code>å‘½ä»¤ä¸è·Ÿæ®æ–‡ä»¶åç¼€ååˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œè€Œæ˜¯æ ¹æ®æ–‡ä»¶æœ€å¤´éƒ¨çš„å‡ ä½Magic Numberè¿›è¡Œåˆ¤æ–­ã€‚å¯¹äºä¹±æ”¹æ–‡ä»¶åç¼€çš„æƒ…å†µéå¸¸é€‚åˆã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-Vostro-3902:~&#x2F;Desktop$ file 1945300044.png</span><br><span class="line">1945300044.png: JPEG image data</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-14-linux-commands/" data-id="cklf7tst7001lz8t4f50868r6" data-title="Linuxå¸¸ç”¨å‘½ä»¤" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Script/" rel="tag">Script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-19-monitor-tomcat-in-docker" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-19-monitor-tomcat-in-docker/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">è¿ç»´</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-19-monitor-tomcat-in-docker/">ä½¿ç”¨Mointç›‘æ§Dockerä¸­è¿è¡Œçš„WebæœåŠ¡å™¨</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Monitæ˜¯ä¸€ä¸ªLinuxç³»ç»Ÿä¸­å¸¸ç”¨çš„ç›‘æ§è½¯ä»¶ï¼Œå¯ä»¥ç›‘æ§CPUã€å†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿã€TCPç«¯å£ã€UDPç«¯å£ã€HTTPç­‰åŸºæœ¬ä¸Šæ‰€æœ‰çš„èµ„æºã€‚å¯ä»¥å‚è€ƒå…¶å®˜æ–¹ç½‘ç«™ï¼š<a target="_blank" rel="noopener" href="https://mmonit.com/monit/%E3%80%82">https://mmonit.com/monit/ã€‚</a></p>
<p>æœ¬æ¬¡è¦å¯¹Dockerï¼ˆDockerä¸­è¿è¡Œäº†ä¸€ä¸ªWebæœåŠ¡å™¨ï¼‰è¿›è¡Œç›‘æ§ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªéœ€æ±‚ï¼š</p>
<ol>
<li>å½“DockeræŒ‚æ‰çš„æ—¶å€™è‡ªåŠ¨å¯åŠ¨ï¼›</li>
<li>å½“Dockerä¸­çš„WebæœåŠ¡å™¨300ç§’å†…æ— å“åº”çš„æ—¶å€™é‡å¯Dockerï¼›</li>
<li>å½“Dockerå‘ç”Ÿå¼‚å¸¸æˆ–è€…é‡å¯æ—¶ï¼Œå‘é€é‚®ä»¶è­¦å‘Šé€šçŸ¥ã€‚</li>
</ol>
<h2 id="å®‰è£…Mointè½¯ä»¶"><a href="#å®‰è£…Mointè½¯ä»¶" class="headerlink" title="å®‰è£…Mointè½¯ä»¶"></a>å®‰è£…Mointè½¯ä»¶</h2><p>Mointçš„å®‰è£…æ¯”è¾ƒå®¹æ˜“ï¼Œå¦‚æœä½¿ç”¨Ubuntu/Debianï¼Œåˆ™å¯ä»¥ç›´æ¥æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install monit</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨æºä»£ç ç¼–è¯‘å®‰è£…ï¼Œåˆ™æ˜¯ç»å…¸ä¸‰éƒ¨æ›²ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h2 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h2><p>è¿™é‡ŒåªæåŠå‡ ä¸ªæ¯”è¾ƒé‡è¦çš„è®¾ç½®ï¼Œå…¶ä»–è®¾ç½®å¯ä»¥å‚è€ƒLinuxæ‰‹å†Œã€‚</p>
<h3 id="ç›‘æ§è¿›ç¨‹æ£€æŸ¥å‘¨æœŸ"><a href="#ç›‘æ§è¿›ç¨‹æ£€æŸ¥å‘¨æœŸ" class="headerlink" title="ç›‘æ§è¿›ç¨‹æ£€æŸ¥å‘¨æœŸ"></a>ç›‘æ§è¿›ç¨‹æ£€æŸ¥å‘¨æœŸ</h3><p>é»˜è®¤ä¸º120ç§’æ£€æŸ¥ä¸€æ¬¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">###############################################################################</span><br><span class="line">## Global section</span><br><span class="line">###############################################################################</span><br><span class="line">##</span><br><span class="line">## Start Monit in the background (run as a daemon):</span><br><span class="line">#</span><br><span class="line">  set daemon 30            # check services at 30-seconds intervals</span><br><span class="line">#   with start delay 120   # optional: delay the first check by 4-minutes (by</span><br><span class="line">#                          # default Monit check immediately after Monit start)</span><br><span class="line">#</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æœ¬åœ°Sendmailå‘é€é‚®ä»¶"><a href="#ä½¿ç”¨æœ¬åœ°Sendmailå‘é€é‚®ä»¶" class="headerlink" title="ä½¿ç”¨æœ¬åœ°Sendmailå‘é€é‚®ä»¶"></a>ä½¿ç”¨æœ¬åœ°Sendmailå‘é€é‚®ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## Set the list of mail servers for alert delivery. Multiple servers may be </span><br><span class="line">## specified using a comma separator. If the first mail server fails, Monit </span><br><span class="line"># will use the second mail server in the list and so on. By default Monit uses </span><br><span class="line"># port 25 - it is possible to override this with the PORT option.</span><br><span class="line">#</span><br><span class="line"># set mailserver mail.bar.baz,               # primary mailserver</span><br><span class="line">#                backup.bar.baz port 10025,  # backup mailserver on port 10025</span><br><span class="line">#                localhost                   # fallback relay</span><br><span class="line"> set mailserver localhost               # primary mailserver</span><br></pre></td></tr></table></figure>
<h3 id="é‚®ä»¶å‘ä»¶äºº"><a href="#é‚®ä»¶å‘ä»¶äºº" class="headerlink" title="é‚®ä»¶å‘ä»¶äºº"></a>é‚®ä»¶å‘ä»¶äºº</h3><p>æˆ‘ç”¨æ¥åŒºåˆ«æ˜¯å“ªå°æœåŠ¡å™¨å‘é€çš„æŠ¥è­¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## You can override this message format or parts of it, such as subject</span><br><span class="line">## or sender using the MAIL-FORMAT statement. Macros such as $DATE, etc.</span><br><span class="line">## are expanded at runtime. For example, to override the sender, use:</span><br><span class="line">#</span><br><span class="line"> set mail-format &#123; from: node1@anying.me &#125;</span><br></pre></td></tr></table></figure>
<h3 id="æŠ¥è­¦é‚®ä»¶æ¥æ”¶äºº"><a href="#æŠ¥è­¦é‚®ä»¶æ¥æ”¶äºº" class="headerlink" title="æŠ¥è­¦é‚®ä»¶æ¥æ”¶äºº"></a>æŠ¥è­¦é‚®ä»¶æ¥æ”¶äºº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## You can set alert recipients whom will receive alerts if&#x2F;when a </span><br><span class="line">## service defined in this file has errors. Alerts may be restricted on </span><br><span class="line">## events by using a filter as in the second example below. </span><br><span class="line">#</span><br><span class="line"> set alert fify@xiaotanzhu.com                       # receive all alerts</span><br></pre></td></tr></table></figure>
<h3 id="ç›‘æ§çš„WebæœåŠ¡"><a href="#ç›‘æ§çš„WebæœåŠ¡" class="headerlink" title="ç›‘æ§çš„WebæœåŠ¡"></a>ç›‘æ§çš„WebæœåŠ¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## Monit has an embedded web server which can be used to view status of </span><br><span class="line">## services monitored and manage services from a web interface. See the</span><br><span class="line">## Monit Wiki if you want to enable SSL for the web server. </span><br><span class="line">#</span><br><span class="line"> set httpd port 2812 and</span><br><span class="line">    use address localhost  # only accept connection from localhost</span><br><span class="line">    allow localhost        # allow localhost to connect to the server and</span><br><span class="line">    allow admin:monit      # require user &#39;admin&#39; with password &#39;monit&#39;</span><br><span class="line">    allow @monit           # allow users of group &#39;monit&#39; to connect (rw)</span><br><span class="line">    allow @users readonly  # allow users of group &#39;users&#39; to connect readonly</span><br></pre></td></tr></table></figure>

<h2 id="ç›‘å¬DockeræœåŠ¡"><a href="#ç›‘å¬DockeræœåŠ¡" class="headerlink" title="ç›‘å¬DockeræœåŠ¡"></a>ç›‘å¬DockeræœåŠ¡</h2><p>åœ¨<code>/etc/monit/conf.d</code>ç›®å½•ä¸‹å¢åŠ ç›‘æ§æ–‡ä»¶<code>irenshi-web</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">check process irenshi-web matching &quot;docker-proxy.*-host-port 8081.*&quot;</span><br><span class="line">  start program &quot;&#x2F;usr&#x2F;bin&#x2F;docker start irenshi-web&quot;</span><br><span class="line">  stop  program &quot;&#x2F;usr&#x2F;bin&#x2F;docker stop irenshi-web&quot;</span><br><span class="line">  if failed host localhost port 8081 protocol http request &quot;&#x2F;web&#x2F;&quot; for 10 times within 12 cycles then restart</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>irenshi-web</code>ä¸ºç›‘æ§é¡¹ç›®åç§°ï¼Œè¿™ä¸ªåç§°å°†æ˜¾ç¤ºåœ¨æŠ¥è­¦é‚®ä»¶ä¸­ã€‚å¦å¤–ï¼Œå¯åŠ¨å’Œå…³é—­é¡¹ç›®ä¹Ÿéœ€è¦ä½¿ç”¨è¯¥åç§°ï¼Œè§<a href="#%E9%9C%80%E8%A6%81%E5%81%9C%E6%AD%A2Docker%E6%97%B6">éœ€è¦åœæ­¢Dockeræ—¶</a></li>
<li><code>matching &quot;docker-proxy.*-host-port 8081.*&quot;</code>é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥è¯†åˆ«è¿›ç¨‹ã€‚é€šå¸¸æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨pidfileæ¥è¯†åˆ«è¿›ç¨‹ï¼Œä½†Dockerçš„å®ä¾‹æ²¡æœ‰è¿›ç¨‹pidfileï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¿›ç¨‹ã€‚Monitåˆ¤æ–­è¿›ç¨‹æ˜¯å¦å­˜åœ¨çš„æ—¶å€™ä¼šæ ¹æ®è¯¥æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¿›ç¨‹åæœç´¢ã€‚</li>
<li><code>start program</code>å¯åŠ¨è¿›ç¨‹çš„æ–¹æ³•ï¼Œè¿™é‡Œå¿…é¡»ä½¿ç”¨å®Œæ•´è·¯å¾„<code>/usr/bin/docker</code>ï¼Œå¦åˆ™ä¼šæ— æ³•æ‰¾åˆ°å‘½ä»¤</li>
<li><code>stop program</code>å…³é—­è¿›ç¨‹çš„æ–¹æ³•ã€‚å½“Monitæ‰§è¡Œé‡å¯çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨<code>stop program</code>ï¼Œç„¶åå†è°ƒç”¨<code>start program</code></li>
<li><code>if failed host localhost port 8081 protocol http request &quot;/web/&quot; for 10 times within 12 cycles then restart</code><ol>
<li><code>if failed</code>æŒ‡å®šè®¿é—®å¤±è´¥æ—¶çš„æƒ…å½¢ã€‚å½“è¿›ç¨‹è¿˜åœ¨ï¼Œä½†æ˜¯WebæœåŠ¡å™¨å·²ç»æŒ‚æ‰æ—¶ï¼Œä¼šè§¦å‘<code>fail</code></li>
<li><code>localhost port 8081</code>ç›‘å¬æœ¬åœ°çš„8081ç«¯å£ï¼Œè¿™æ˜¯Dockeræ˜ å°„ç»™ä¸»æœºçš„ç«¯å£</li>
<li><code>protocol http request &quot;/web/&quot;</code>ä½¿ç”¨HTTPåè®®è¯·æ±‚<code>/web/</code>è¿™ä¸ªé¡µé¢</li>
<li><code>for 10 times within 12 cycles</code>å‡ºç°æ¬¡æ•°è®¾å®šï¼šåœ¨12ä¸ªæ£€æµ‹å‘¨æœŸä¸­ï¼Œå¦‚æœå‡ºç°äº†10æ¬¡æ— æ³•è®¿é—®</li>
<li><code>then restart</code>æ»¡è¶³ä»¥ä¸Šæ¡ä»¶æ—¶æ‰§è¡Œçš„æ“ä½œï¼Œè¿™é‡Œæ‰§è¡Œ<code>restart</code></li>
</ol>
</li>
</ul>
<p>å¤‡æ³¨ï¼šDockerçš„å®Œæ•´è¿›ç¨‹åä¸º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 8081 -container-ip 192.168.42.253 -container-port 8080</span><br></pre></td></tr></table></figure>
<p>ç”±äºåŒä¸€å°æœºå™¨ä¸Šå¯åŠ¨äº†è‹¥å¹²ä¸ªDockerï¼Œä¸ºé˜²æ­¢å¹²æ‰°æˆ‘ä»¬é‡‡ç”¨äº†å–å·§çš„æ–¹æ³•ï¼Œç”¨<code>-host-port 8086</code>æ¥è¯†åˆ«è¿›ç¨‹å®ä¾‹ã€‚</p>
<h2 id="éœ€è¦åœæ­¢Dockeræ—¶"><a href="#éœ€è¦åœæ­¢Dockeræ—¶" class="headerlink" title="éœ€è¦åœæ­¢Dockeræ—¶"></a>éœ€è¦åœæ­¢Dockeræ—¶</h2><p>å¦‚æœä½¿ç”¨<code>docker stop irenshi-web</code>å‘½ä»¤åœæ­¢Dockerçš„è¯ï¼ŒMonitæ£€æµ‹åˆ°åº”ç”¨ä¸å­˜åœ¨ä¼šç«‹å³é‡æ–°å¯åŠ¨ã€‚æ‰€ä»¥åº”è¯¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å…³é—­Dockerï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monit -c /etc/monit/monitrc stop irenshi-web</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦é‡æ–°å¯åŠ¨ï¼Œåˆ™å¯¹åº”æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">monit -c /etc/monit/monitrc start irenshi-web</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-19-monitor-tomcat-in-docker/" data-id="cklf7tst9001pz8t4e91yguwu" data-title="ä½¿ç”¨Mointç›‘æ§Dockerä¸­è¿è¡Œçš„WebæœåŠ¡å™¨" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Moint/" rel="tag">Moint</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">ç›‘æ§</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-23-create-db-user-in-mysql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-23-create-db-user-in-mysql/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-23-create-db-user-in-mysql/">åœ¨MySQLä¸­åˆ›å»ºåº“å’Œç”¨æˆ·</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `irenshi` <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;irenshi&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;irenshi&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="æˆæƒæ•°æ®åº“è®¿é—®"><a href="#æˆæƒæ•°æ®åº“è®¿é—®" class="headerlink" title="æˆæƒæ•°æ®åº“è®¿é—®"></a>æˆæƒæ•°æ®åº“è®¿é—®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> irenshi.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;irenshi&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-23-create-db-user-in-mysql/" data-id="cklf7tstb001tz8t4cj31exwp" data-title="åœ¨MySQLä¸­åˆ›å»ºåº“å’Œç”¨æˆ·" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-06-16-delete-keys-in-batch-redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-06-16-delete-keys-in-batch-redis/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-06-16-delete-keys-in-batch-redis/">æ‰¹é‡åˆ é™¤Redisæ•°æ®åº“ä¸­çš„Key</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>è½¬è½½è‡ªï¼š<a target="_blank" rel="noopener" href="http://img.snail8.com/?p=502">http://img.snail8.com/?p=502</a></p>
</blockquote>
<p>Redisä¸­æœ‰åˆ é™¤å•ä¸ªKeyçš„æŒ‡ä»¤<code>DEL</code>ï¼Œä½†å¥½åƒæ²¡æœ‰æ‰¹é‡åˆ é™¤Keyçš„æŒ‡ä»¤ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥å€ŸåŠ©Linuxçš„<code>xargs</code>æŒ‡ä»¤æ¥å®Œæˆè¿™ä¸ªåŠ¨ä½œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli keys <span class="string">&quot;*&quot;</span> | xargs redis-cli del</span><br><span class="line"><span class="comment"># å¦‚æœredis-cliæ²¡æœ‰è®¾ç½®æˆç³»ç»Ÿå˜é‡ï¼Œéœ€è¦æŒ‡å®šredis-cliçš„å®Œæ•´è·¯å¾„</span></span><br><span class="line"><span class="comment"># å¦‚ï¼š/opt/redis/redis-cli keys &quot;*&quot; | xargs /opt/redis/redis-cli del</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æŒ‡å®š Redis æ•°æ®åº“è®¿é—®å¯†ç ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a password keys <span class="string">&quot;*&quot;</span> | xargs redis-cli -a password del</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦è®¿é—® Redis ä¸­ç‰¹å®šçš„æ•°æ®åº“ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢çš„å‘½ä»¤æŒ‡å®šæ•°æ®åºå·ä¸º0ï¼Œå³é»˜è®¤æ•°æ®åº“</span></span><br><span class="line">redis-cli -n 0 keys <span class="string">&quot;*&quot;</span> | xargs redis-cli -n 0 del</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤æ‰€æœ‰Keyï¼Œå¯ä»¥ä½¿ç”¨Redisçš„flushdbå’Œflushallå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰Key</span></span><br><span class="line">flushdb</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„key</span></span><br><span class="line">flushall</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-06-16-delete-keys-in-batch-redis/" data-id="cklf7tssc0001z8t48qi103ky" data-title="æ‰¹é‡åˆ é™¤Redisæ•°æ®åº“ä¸­çš„Key" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">è½¬è½½</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-25-mysql-basic-config" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-25-mysql-basic-config/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-25-mysql-basic-config/">MySQLæœåŠ¡å™¨é…ç½®</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>MySQLç‰ˆæœ¬ä¿¡æ¯ï¼š</p>
<blockquote>
<p>mysqld  Ver 5.6.31-0ubuntu0.14.04.2 for debian-linux-gnu on x86_64 ((Ubuntu))</p>
</blockquote>
<h2 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># The MySQL database server configuration file.</span><br><span class="line">#</span><br><span class="line"># You can copy this to one of:</span><br><span class="line"># - &quot;/etc/mysql/my.cnf&quot; to set global options,</span><br><span class="line"># - &quot;~/.my.cnf&quot; to set user-specific options.</span><br><span class="line"># </span><br><span class="line"># One can use all long options that the program supports.</span><br><span class="line"># Run program with --help to get a list of available options and with</span><br><span class="line"># --print-defaults to see which it would actually understand and use.</span><br><span class="line">#</span><br><span class="line"># For explanations see</span><br><span class="line"># http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span><br><span class="line"></span><br><span class="line"># This will be passed to all mysql clients</span><br><span class="line"># It has been reported that passwords should be enclosed with ticks/quotes</span><br><span class="line"># escpecially if they contain &quot;#&quot; chars...</span><br><span class="line"># Remember to edit /etc/mysql/debian.cnf when changing the socket location.</span><br><span class="line">[client]</span><br><span class="line">port            = 3306</span><br><span class="line">socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line"><span class="addition">+ default-character-set = utf8mb4</span></span><br><span class="line"></span><br><span class="line"># Here is entries for some specific programs</span><br><span class="line"># The following values assume you have at least 32M ram</span><br><span class="line"></span><br><span class="line"># This was formally known as [safe_mysqld]. Both versions are currently parsed.</span><br><span class="line">[mysqld_safe]</span><br><span class="line">socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line">nice            = 0</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">#</span><br><span class="line"># * Basic Settings</span><br><span class="line">#</span><br><span class="line"><span class="addition">+ skip-host-cache</span></span><br><span class="line">user            = mysql</span><br><span class="line">pid-file        = /var/run/mysqld/mysqld.pid</span><br><span class="line">socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line">port            = 3306</span><br><span class="line">basedir         = /usr</span><br><span class="line">datadir         = /var/lib/mysql</span><br><span class="line">tmpdir          = /tmp</span><br><span class="line">lc-messages-dir = /usr/share/mysql</span><br><span class="line"><span class="addition">+ explicit_defaults_for_timestamp</span></span><br><span class="line">skip-external-locking</span><br><span class="line">#</span><br><span class="line"># Instead of skip-networking the default is now to listen only on</span><br><span class="line"># localhost which is more compatible and is not less secure.</span><br><span class="line"><span class="deletion">- bind-address           = 127.0.0.1</span></span><br><span class="line"><span class="addition">+ #bind-address           = 127.0.0.1</span></span><br><span class="line">#</span><br><span class="line"># * Fine Tuning</span><br><span class="line">#</span><br><span class="line">key_buffer              = 16M</span><br><span class="line">max_allowed_packet      = 16M</span><br><span class="line">thread_stack            = 192K</span><br><span class="line">thread_cache_size       = 8</span><br><span class="line"># This replaces the startup script and checks MyISAM tables if needed</span><br><span class="line"># the first time they are touched</span><br><span class="line">myisam-recover         = BACKUP</span><br><span class="line"><span class="deletion">- #max_connections        = 100</span></span><br><span class="line"><span class="addition">+ max_connections        = 1000</span></span><br><span class="line">#table_cache            = 64</span><br><span class="line">thread_concurrency     = 10</span><br><span class="line">#</span><br><span class="line"># * Query Cache Configuration</span><br><span class="line">#</span><br><span class="line">query_cache_limit       = 1M</span><br><span class="line">query_cache_size        = 16M</span><br><span class="line"><span class="addition">+ skip_name_resolve       = 1</span></span><br><span class="line"><span class="addition">+ lower_case_table_names  = 1</span></span><br><span class="line"><span class="addition">+ max_allowed_packet      = 32M</span></span><br><span class="line">#</span><br><span class="line"># * Logging and Replication</span><br><span class="line">#</span><br><span class="line"># Both location gets rotated by the cronjob.</span><br><span class="line"># Be aware that this log type is a performance killer.</span><br><span class="line"># As of 5.1 you can enable the log at runtime!</span><br><span class="line">#general_log_file        = /var/log/mysql/mysql.log</span><br><span class="line">#general_log             = 1</span><br><span class="line">#</span><br><span class="line"># Error log - should be very few entries.</span><br><span class="line">#</span><br><span class="line">log_error = /var/log/mysql/error.log</span><br><span class="line">#</span><br><span class="line"># Here you can see queries with especially long duration</span><br><span class="line">#log_slow_queries       = /var/log/mysql/mysql-slow.log</span><br><span class="line">#long_query_time = 2</span><br><span class="line">#log-queries-not-using-indexes</span><br><span class="line"><span class="addition">+ # åƒä¸‡ä¸è¦ä½¿ç”¨log_slow_queriesï¼Œè¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„å‚æ•°ï¼Œä¼šå¯¼è‡´MySQLæ— æ³•å¯åŠ¨</span></span><br><span class="line"><span class="addition">+ slow_query_log          = 1</span></span><br><span class="line"><span class="addition">+ slow_query_log_file     = /var/log/mysql/slow.log</span></span><br><span class="line"><span class="addition">+ long_query_time         = 10</span></span><br><span class="line">#</span><br><span class="line"># The following can be used as easy to replay backup logs or for replication.</span><br><span class="line"># note: if you are setting up a replication slave, see README.Debian about</span><br><span class="line">#       other settings you may need to change.</span><br><span class="line"><span class="deletion">- #server-id              = 1</span></span><br><span class="line"><span class="addition">+ server-id               = 2</span></span><br><span class="line"><span class="deletion">- #log_bin                 = /var/log/mysql/mysql-bin.log</span></span><br><span class="line"><span class="addition">+ log_bin                 = /var/log/mysql/mysql-bin.log</span></span><br><span class="line">expire_logs_days        = 10</span><br><span class="line">max_binlog_size         = 100M</span><br><span class="line"><span class="addition">+ read-only               = 0</span></span><br><span class="line">#binlog_do_db           = include_database_name</span><br><span class="line">#binlog_ignore_db       = include_database_name</span><br><span class="line"><span class="addition">+ binlog-ignore-db        = mysql</span></span><br><span class="line"><span class="addition">+ binlog-ignore-db        = information_schema</span></span><br><span class="line"><span class="addition">+ binlog-ignore-db        = performance_schema</span></span><br><span class="line"><span class="addition">+ ## GTID: Global Transaction ID</span></span><br><span class="line"><span class="addition">+ gtid_mode               = on</span></span><br><span class="line"><span class="addition">+ enforce_gtid_consistency= on</span></span><br><span class="line"><span class="addition">+ log-slave-updates       = 1</span></span><br><span class="line"><span class="addition">+ # For all slave servers</span></span><br><span class="line"><span class="addition">+ skip_slave_start        = 1</span></span><br><span class="line">#</span><br><span class="line"># * InnoDB</span><br><span class="line">#</span><br><span class="line"># InnoDB is enabled by default with a 10MB datafile in /var/lib/mysql/.</span><br><span class="line"># Read the manual for more InnoDB related options. There are many!</span><br><span class="line">#</span><br><span class="line"># * Security Features</span><br><span class="line">#</span><br><span class="line"># Read the manual, too, if you want chroot!</span><br><span class="line"># chroot = /var/lib/mysql/</span><br><span class="line">#</span><br><span class="line"># For generating SSL certificates I recommend the OpenSSL GUI &quot;tinyca&quot;.</span><br><span class="line">#</span><br><span class="line"># ssl-ca=/etc/mysql/cacert.pem</span><br><span class="line"># ssl-cert=/etc/mysql/server-cert.pem</span><br><span class="line"># ssl-key=/etc/mysql/server-key.pem</span><br><span class="line"></span><br><span class="line"><span class="addition">+ max_connect_errors      = 20</span></span><br><span class="line"><span class="addition">+ interactive_timeout     = 172800</span></span><br><span class="line"><span class="addition">+ wait_timeout            = 172800</span></span><br><span class="line"></span><br><span class="line"># Character sets</span><br><span class="line"><span class="addition">+ character-set-client-handshake = FALSE</span></span><br><span class="line"><span class="addition">+ character-set-server    = utf8mb4</span></span><br><span class="line"><span class="addition">+ collation-server        = utf8mb4_unicode_ci</span></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">quote-names</span><br><span class="line"><span class="addition">+ max_allowed_packet      = 32M</span></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">#no-auto-rehash # faster start of mysql but no tab completition</span><br><span class="line"><span class="addition">+ default-character-set   = utf8mb4</span></span><br><span class="line"></span><br><span class="line">[isamchk]</span><br><span class="line">key_buffer              = 16M</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># * IMPORTANT: Additional settings that can override those from this file!</span><br><span class="line">#   The files must end with &#x27;.cnf&#x27;, otherwise they&#x27;ll be ignored.</span><br><span class="line">#</span><br><span class="line"><span class="addition">!includedir /etc/mysql/conf.d/</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-25-mysql-basic-config/" data-id="cklf7tstf0021z8t456qp3kyu" data-title="MySQLæœåŠ¡å™¨é…ç½®" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-25-mysql-gtid-master-slave" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-25-mysql-gtid-master-slave/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-25-mysql-gtid-master-slave/">ä½¿ç”¨GTIDæœºåˆ¶åˆ›å»ºMySQLä¸»ä»å¤‡ä»½å’Œä¸»ä¸»å¤‡ä»½</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p><strong>æ³¨æ„ï¼š</strong>GTIDæœºåˆ¶åªé€‚ç”¨ä¸MySQL 5.6.10åŠæ›´æ–°ç‰ˆæœ¬ã€‚</p>
</blockquote>
<h2 id="GTIDæ¯”ä¼ ç»Ÿå¤åˆ¶çš„ä¼˜åŠ¿"><a href="#GTIDæ¯”ä¼ ç»Ÿå¤åˆ¶çš„ä¼˜åŠ¿" class="headerlink" title="GTIDæ¯”ä¼ ç»Ÿå¤åˆ¶çš„ä¼˜åŠ¿"></a>GTIDæ¯”ä¼ ç»Ÿå¤åˆ¶çš„ä¼˜åŠ¿</h2><ol>
<li>æ›´ç®€å•çš„å®ç°failoverï¼Œä¸ç”¨ä»¥å‰é‚£æ ·åœ¨éœ€è¦æ‰¾log_fileå’Œlog_Posã€‚</li>
<li>æ›´ç®€å•çš„æ­å»ºä¸»ä»å¤åˆ¶ã€‚</li>
<li>æ¯”ä¼ ç»Ÿå¤åˆ¶æ›´åŠ å®‰å…¨ã€‚</li>
<li>GTIDæ˜¯è¿ç»­æ²¡æœ‰ç©ºæ´çš„ï¼Œå› æ­¤ä¸»ä»åº“å‡ºç°æ•°æ®å†²çªæ—¶ï¼Œå¯ä»¥ç”¨æ·»åŠ ç©ºäº‹ç‰©çš„æ–¹å¼è¿›è¡Œè·³è¿‡ã€‚</li>
</ol>
<h2 id="GTIDçš„å·¥ä½œåŸç†ï¼š"><a href="#GTIDçš„å·¥ä½œåŸç†ï¼š" class="headerlink" title="GTIDçš„å·¥ä½œåŸç†ï¼š"></a>GTIDçš„å·¥ä½œåŸç†ï¼š</h2><ol>
<li>masteræ›´æ–°æ•°æ®æ—¶ï¼Œä¼šåœ¨äº‹åŠ¡å‰äº§ç”ŸGTIDï¼Œä¸€åŒè®°å½•åˆ°binlogæ—¥å¿—ä¸­ã€‚</li>
<li>slaveç«¯çš„i/o çº¿ç¨‹å°†å˜æ›´çš„binlogï¼Œå†™å…¥åˆ°æœ¬åœ°çš„relay logä¸­ã€‚</li>
<li>sqlçº¿ç¨‹ä»relay logä¸­è·å–GTIDï¼Œç„¶åå¯¹æ¯”slaveç«¯çš„binlogæ˜¯å¦æœ‰è®°å½•ã€‚</li>
<li>å¦‚æœæœ‰è®°å½•ï¼Œè¯´æ˜è¯¥GTIDçš„äº‹åŠ¡å·²ç»æ‰§è¡Œï¼Œslaveä¼šå¿½ç•¥ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è®°å½•ï¼Œslaveå°±ä¼šä»relay logä¸­æ‰§è¡Œè¯¥GTIDçš„äº‹åŠ¡ï¼Œå¹¶è®°å½•åˆ°binlogã€‚</li>
<li>åœ¨è§£æè¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ä¸»é”®ï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨äºŒçº§ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨å…¨éƒ¨æ‰«æã€‚</li>
</ol>
<p><strong>è¦ç‚¹ï¼š</strong></p>
<ol>
<li>slaveåœ¨æ¥å—masterçš„binlogæ—¶ï¼Œä¼šæ ¡éªŒmasterçš„GTIDæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡ï¼ˆä¸€ä¸ªæœåŠ¡å™¨åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚</li>
<li>ä¸ºäº†ä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¤šçº¿ç¨‹åªèƒ½åŒæ—¶æ‰§è¡Œä¸€ä¸ªGTIDã€‚</li>
</ol>
<h2 id="MySQLå¯åŠ¨GTIDæœºåˆ¶"><a href="#MySQLå¯åŠ¨GTIDæœºåˆ¶" class="headerlink" title="MySQLå¯åŠ¨GTIDæœºåˆ¶"></a>MySQLå¯åŠ¨GTIDæœºåˆ¶</h2><p>ä¸»ä»MySQLçš„é…ç½®åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äº<code>server_id</code><strong>å¿…é¡»</strong>ä¸åŒï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">server-id</span>               = <span class="number">2</span></span><br><span class="line"><span class="comment"># åœ¨GTIDæœºåˆ¶ä¸‹ä»æœåŠ¡å™¨ä¹Ÿå¿…é¡»å¼€å¯</span></span><br><span class="line"><span class="attr">log_bin</span>                 = /var/log/mysql/mysql-bin.log</span><br><span class="line"><span class="comment"># å‚è€ƒä¸‹æ–‡è¯´æ˜ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨row</span></span><br><span class="line"><span class="attr">binlog_format</span>           = row</span><br><span class="line"><span class="attr">expire_logs_days</span>        = <span class="number">10</span></span><br><span class="line"><span class="attr">max_binlog_size</span>         = <span class="number">100</span>M</span><br><span class="line"><span class="attr">read-only</span>               = <span class="number">0</span></span><br><span class="line"><span class="attr">binlog-ignore-db</span>        = mysql</span><br><span class="line"><span class="attr">binlog-ignore-db</span>        = information_schema</span><br><span class="line"><span class="attr">binlog-ignore-db</span>        = performance_schema</span><br><span class="line"><span class="comment">#binlog_ignore_db       = include_database_name</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## GTID: Global Transaction ID</span></span><br><span class="line"><span class="attr">gtid_mode</span>               = <span class="literal">on</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸»ä»å¤åˆ¶çš„æ—¶å€™å¿…é¡»å¯ç”¨</span></span><br><span class="line"><span class="attr">enforce_gtid_consistency</span>= <span class="literal">on</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ä¸»ä»å¤åˆ¶çš„æ—¶å€™å¿…é¡»å¯ç”¨</span></span><br><span class="line"><span class="attr">log-slave-updates</span>       = <span class="number">1</span></span><br><span class="line"><span class="comment"># For all slave servers</span></span><br><span class="line"><span class="attr">skip_slave_start</span>        = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>å…³äº<code>binlog-format = row</code>çš„<a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.7/en/binary-log-setting.html">å®˜æ–¹æè¿°</a>ï¼š</p>
<blockquote>
<p><strong>Warning</strong><br>When using statement-based logging for replication, it is possible for the data on the master and slave to become different if a statement is designed in such a way that the data modification is nondeterministic; that is, it is left to the will of the query optimizer. In general, this is not a good practice even outside of replication. For a detailed explanation of this issue, see Section B.5.7, â€œKnown Issues in MySQLâ€.</p>
</blockquote>
<p>é‡æ–°å¯åŠ¨MySQLæœåŠ¡å™¨ï¼Œå¯ä»¥æŸ¥çœ‹GTIDæ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global variables like &#39;%gtid%&#39;;</span><br><span class="line">+---------------------------------+-----------------------------------------------+</span><br><span class="line">| Variable_name                   | Value                                         |</span><br><span class="line">+---------------------------------+-----------------------------------------------+</span><br><span class="line">| binlog_gtid_simple_recovery     | OFF                                           |</span><br><span class="line">| enforce_gtid_consistency        | ON                                            |</span><br><span class="line">| gtid_executed                   | 3591a291-699c-11e6-8386-0242ac1100f2:1-1830   |</span><br><span class="line">| gtid_mode                       | ON                                            |</span><br><span class="line">| gtid_owned                      | 3591a291-699c-11e6-8386-0242ac1100f2:1831#127 |</span><br><span class="line">| gtid_purged                     |                                               |</span><br><span class="line">| simplified_binlog_gtid_recovery | OFF                                           |</span><br><span class="line">+---------------------------------+-----------------------------------------------+</span><br><span class="line">7 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸€æ¡æ›´æ–°è¯­å¥ï¼Œç„¶åå°±å¯ä»¥çœ‹åˆ°GTIDçš„çŠ¶æ€äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             File: mysql-bin.000001</span><br><span class="line">         Position: 1070635555</span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: mysql,information_schema,performance_schema</span><br><span class="line">Executed_Gtid_Set: 3591a291-699c-11e6-8386-0242ac1100f2:1-1745</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨ä¸»ä»å¤åˆ¶"><a href="#å¯åŠ¨ä¸»ä»å¤åˆ¶" class="headerlink" title="å¯åŠ¨ä¸»ä»å¤åˆ¶"></a>å¯åŠ¨ä¸»ä»å¤åˆ¶</h2><h3 id="åˆ›å»ºMasterçš„Replicaå¸å·ï¼š"><a href="#åˆ›å»ºMasterçš„Replicaå¸å·ï¼š" class="headerlink" title="åˆ›å»ºMasterçš„Replicaå¸å·ï¼š"></a>åˆ›å»ºMasterçš„Replicaå¸å·ï¼š</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;slave&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨æ–°ç³»ç»Ÿä¸­å¯åŠ¨Slave"><a href="#åœ¨æ–°ç³»ç»Ÿä¸­å¯åŠ¨Slave" class="headerlink" title="åœ¨æ–°ç³»ç»Ÿä¸­å¯åŠ¨Slave"></a>åœ¨æ–°ç³»ç»Ÿä¸­å¯åŠ¨Slave</h3><p>å¦‚æœæ‰€æœ‰çš„Binlogéƒ½å­˜åœ¨Masterä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ–°çš„MySQLç³»ç»Ÿï¼Œæ­¤æ—¶å¯ä»¥éå¸¸å®¹æ˜“çš„å¯åŠ¨Slaveï¼Œåªéœ€è¦åœ¨Slaveä¸­æ‰§è¡Œï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.1.3&#x27;</span>, master_port<span class="operator">=</span><span class="number">3307</span>, master_user<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;slave&#x27;</span>, master_auto_position<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€ä¸ªå‚æ•°<code>master_auto_position=1</code>å‘Šè¯‰SlaveæœåŠ¡å™¨è‡ªåŠ¨å»å¯»æ‰¾Binlogçš„ä½ç½®ï¼Œå¹¶ä¸”å¯åŠ¨Slaveã€‚</p>
<p>æ­¤æ—¶å¯ä»¥æŸ¥çœ‹Slaveçš„çŠ¶æ€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show slave status\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.1.3</span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: 3307</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000005</span><br><span class="line">          Read_Master_Log_Pos: 22069</span><br><span class="line">               Relay_Log_File: mysqld-relay-bin.000005</span><br><span class="line">                Relay_Log_Pos: 29521031</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000003</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 29520821</span><br><span class="line">              Relay_Log_Space: 973528215</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 6454</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: 3591a291-699c-11e6-8386-0242ac1100f2</span><br><span class="line">             Master_Info_File: &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: executing</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: 3591a291-699c-11e6-8386-0242ac1100f2:1-2114</span><br><span class="line">            Executed_Gtid_Set: 3591a291-699c-11e6-8386-0242ac1100f2:1-1750</span><br><span class="line">                Auto_Position: 1</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR: </span><br><span class="line">No query specified</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ä»¥ä¸‹ä¸¤ä¸ªå­—æ®µéƒ½åº”è¯¥ä¸ºYesï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨å·²æœ‰ç³»ç»Ÿä¸­å¯åŠ¨Slave"><a href="#åœ¨å·²æœ‰ç³»ç»Ÿä¸­å¯åŠ¨Slave" class="headerlink" title="åœ¨å·²æœ‰ç³»ç»Ÿä¸­å¯åŠ¨Slave"></a>åœ¨å·²æœ‰ç³»ç»Ÿä¸­å¯åŠ¨Slave</h3><p>ä½¿ç”¨mysqldumpçš„æ–¹å¼ï¼š</p>
<ol>
<li>åœ¨å¤‡ä»½çš„æ—¶å€™æŒ‡å®šâ€“master-data=2ï¼ˆæ¥ä¿å­˜binlogçš„æ–‡ä»¶å·å’Œä½ç½®çš„å‘½ä»¤ï¼‰ã€‚</li>
<li>ä½¿ç”¨mysqldumpçš„å‘½ä»¤åœ¨dumpæ–‡ä»¶é‡Œå¯ä»¥çœ‹åˆ°ä¸‹é¢ä¸¤ä¸ªä¿¡æ¯ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET @@SESSION.SQL_LOG_BIN&#x3D;0;</span><br><span class="line">SET @@GLOBAL.GTID_PURGED&#x3D;&#39;7800a22c-95ae-11e4-983d-080027de205a:1-8&#39;;</span><br></pre></td></tr></table></figure></li>
<li>å°†å¤‡ä»½è¿˜åŸåˆ°slaveåï¼Œä½¿ç”¨change master toå‘½ä»¤æŒ‚è½½masterç«¯ã€‚</li>
</ol>
<h2 id="å¯åŠ¨ä¸»ä¸»å¤åˆ¶"><a href="#å¯åŠ¨ä¸»ä¸»å¤åˆ¶" class="headerlink" title="å¯åŠ¨ä¸»ä¸»å¤åˆ¶"></a>å¯åŠ¨ä¸»ä¸»å¤åˆ¶</h2><p>ä¸»ä¸»å¤åˆ¶åªæ˜¯éœ€è¦å°†ä¸¤ä¸ªMySQLæœåŠ¡å™¨äº’ä¸ºä¸»ä»ã€‚åœ¨ä¸ŠèŠ‚çš„ä»æœåŠ¡å™¨ä¸­æ‰§è¡Œä¸»æœåŠ¡å™¨çš„æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;slave&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;repl&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸ŠèŠ‚ä¸­çš„ä¸»æœåŠ¡å™¨æ‰§è¡Œä»æœåŠ¡å™¨çš„æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.1.3&#x27;</span>, master_port<span class="operator">=</span><span class="number">3308</span>, master_user<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;slave&#x27;</span>, master_auto_position<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™ä¸¤å°æœåŠ¡å™¨ä¸ºäº’ä¸ºå¤‡ä»½çš„çŠ¶æ€ã€‚</p>
<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="å¦‚æœmysqlå¯¼å…¥çš„è¿‡ç¨‹ä¸­å¤±è´¥"><a href="#å¦‚æœmysqlå¯¼å…¥çš„è¿‡ç¨‹ä¸­å¤±è´¥" class="headerlink" title="å¦‚æœmysqlå¯¼å…¥çš„è¿‡ç¨‹ä¸­å¤±è´¥"></a>å¦‚æœmysqlå¯¼å…¥çš„è¿‡ç¨‹ä¸­å¤±è´¥</h3><p>å¦‚æœå¯¼å…¥è¿‡ç¨‹ä¸­MySQLæŠ¥é”™ï¼Œåˆ™å†æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¼šæŠ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@server-base:&#x2F;tmp&#x2F;irenshiâŸ« mysql -uroot -proot -h192.168.1.4 -P3307 &lt; irenshi.sql</span><br><span class="line">ERROR 1840 (HY000) at line 24: @@GLOBAL.GTID_PURGED can only be set when @@GLOBAL.GTID_EXECUTED is empty.</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶åªéœ€è¦åœ¨ä»æœåŠ¡å™¨ä¸­æ‰§è¡Œresetå‘½ä»¤å³å¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reset master</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>å‚è€ƒï¼š</strong><a target="_blank" rel="noopener" href="https://avdeo.com/tag/error-1840-hy000-global-gtid_purged-can-only-be-set-when/">https://avdeo.com/tag/error-1840-hy000-global-gtid_purged-can-only-be-set-when/</a></p>
</blockquote>
<h3 id="å¯åŠ¨salveä¹‹åæŠ¥é”™"><a href="#å¯åŠ¨salveä¹‹åæŠ¥é”™" class="headerlink" title="å¯åŠ¨salveä¹‹åæŠ¥é”™"></a>å¯åŠ¨salveä¹‹åæŠ¥é”™</h3><p>å¦‚æˆ‘çš„slaveæŠ¥äº†å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Last_SQL_Errno: 1049</span><br><span class="line">Last_SQL_Error: Error &#39;Unknown database &#39;irenshi&#39;&#39; on query. Default database: &#39;irenshi&#39;. Query: &#39;CREATE TABLE &#96;C3P0_TEST_TABLE&#96; (</span><br><span class="line">  &#96;a&#96; char(1) DEFAULT NULL</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8&#39;</span><br><span class="line">Retrieved_Gtid_Set: 3591a291-699c-11e6-8386-0242ac1100f2:1-1751</span><br><span class="line">Executed_Gtid_Set: 3591a291-699c-11e6-8386-0242ac1100f2:1-7</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæˆ‘çš„ä»æ•°æ®åº“ä¸­å¤šäº†<code>irenshi</code>è¿™ä¸ªè¡¨æ ¼ï¼Œå¹¶ä¸”é»˜è®¤è¡¨æ ¼ä¹Ÿä¸º<code>irenshi</code>ï¼Œå¯¼è‡´æ— æ³•æ‰§è¡Œã€‚</p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘çš„ä»åº“ç›®å‰è·å–åˆ°ä¸»åº“çš„GtidSetä¸º1-1751ï¼Œä½†æ˜¯åªæ‰§è¡Œåˆ°äº†1-7ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·³è¿‡ç¬¬8ä¸ªGTIDï¼š</p>
<blockquote>
<ol>
<li>stop slave;</li>
<li>set GTID_NEXT=â€™3591a291-699c-11e6-8386-0242ac1100f2:8â€™;</li>
<li>begin;</li>
<li>commit;</li>
<li>set GTID_NEXT=â€™AUTOMATICâ€™;</li>
<li>start slave;</li>
</ol>
</blockquote>
<p>æ­¤æ—¶å†çœ‹slaveçš„çŠ¶æ€ï¼Œå·²ç»è·³è¿‡äº†ç¬¬8ä¸ªGTIDã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-25-mysql-gtid-master-slave/" data-id="cklf7tsth0025z8t4d2pdg8cq" data-title="ä½¿ç”¨GTIDæœºåˆ¶åˆ›å»ºMySQLä¸»ä»å¤‡ä»½å’Œä¸»ä¸»å¤‡ä»½" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GTID/" rel="tag">GTID</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" rel="tag">ä¸»ä»å¤åˆ¶</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-26-mysql-error-2006" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-26-mysql-error-2006/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-26-mysql-error-2006/">MySQLå¯¼å…¥æ•°æ®é”™è¯¯ï¼šERROR 2006 (HY000) at line 1&amp;#58; MySQL server has gone away</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è¿™ä¸ªé—®é¢˜å‡ºåœ¨ä½¿ç”¨mysqldumpè¿›è¡Œæ•°æ®è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œé—®é¢˜çš„åŸå› å°±æ˜¯å•æ¡SQLçš„å¤§å°æ¯”æ•°æ®åº“çš„è®¾ç½®æ›´å¤§ã€‚</p>
<p>æ£€æŸ¥ä¸¤ä¸ªåœ°æ–¹çš„é…ç½®ï¼š</p>
<ol>
<li>mysqldumpçš„é…ç½®</li>
<li>mysqldçš„é…ç½®</li>
</ol>
<p>ä¸»è¦å…³æ³¨<strong>max_allowed_packet</strong>å‚æ•°ã€‚</p>
<p><strong>mysqldumpåœ¨/etc/mysql/my.cnfçš„é…ç½®</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqldump]</span></span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">64</span>M</span><br></pre></td></tr></table></figure>

<p><strong>mysqldåœ¨/etc/mysql/my.cnfçš„é…ç½®</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">64</span>M</span><br></pre></td></tr></table></figure>
<p>åªè¦ä¿è¯mysqldä¸­çš„max_allowed_packetä¸å°äºmysqldumpçš„é…ç½®å³å¯ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-26-mysql-error-2006/" data-id="cklf7tsti0029z8t49red8h23" data-title="MySQLå¯¼å…¥æ•°æ®é”™è¯¯ï¼šERROR 2006 (HY000) at line 1&amp;#58; MySQL server has gone away" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysqldump/" rel="tag">mysqldump</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-26-turn-on-swap-on-aliyun-linux" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-26-turn-on-swap-on-aliyun-linux/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">è¿ç»´</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-26-turn-on-swap-on-aliyun-linux/">é˜¿é‡Œäº‘ECS Linuxå¼€å¯swapï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>é˜¿é‡Œäº‘çš„æœåŠ¡å™¨é»˜è®¤æ˜¯ä¸å¼€å¯è™šæ‹Ÿå†…å­˜çš„ï¼Œå®˜æ–¹ç»™å‡ºçš„ç†ç”±å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ç”±äºå¼€å¯swapåˆ†åŒºä¼šå¯¼è‡´ç¡¬ç›˜IOæ€§èƒ½ä¸‹é™ï¼Œå› æ­¤é˜¿é‡Œäº‘æœåŠ¡å™¨åˆå§‹çŠ¶æ€æœªé…ç½®swapã€‚</p>
</blockquote>
<p>è¿™ç¡®å®æ˜¯ä¸ªç†ç”±ï¼Œå¼€å¯swapå¯¹é˜¿é‡Œäº‘å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šçš„å¥½å¤„ï¼š</p>
<ol>
<li>å¼€å¯swapåˆ†åŒºä¼šé€ æˆé˜¿é‡Œäº‘å®¿ä¸»æœºçš„ç£ç›˜è´Ÿè½½å¢å¤§ï¼Œå…¶ä¸€ä¼šå½±å“ç£ç›˜IOæ€§èƒ½ï¼Œå…¶æ¬¡è¿˜ä¼šé™ä½ç£ç›˜ä½¿ç”¨å¯¿å‘½ï¼›</li>
<li>åœ¨é˜¿é‡Œäº‘æ¨å‡ºSSDä¹‹åï¼ŒSSDçš„æ€§èƒ½å’Œå†…å­˜æ€§èƒ½çš„å·®è·ç›¸å¯¹æœºæ¢°ç¡¬ç›˜æ¥è¯´å‡å°å¾ˆå¤šï¼ŒSSDè®¾ç½®å¯ä»¥å½“å†…å­˜ä½¿ç”¨ã€‚ä½†æ˜¯SSDå’Œå†…å­˜çš„ä»·æ ¼å·®åˆ«ä¸æ˜¯ä¸€ç‚¹åŠç‚¹ã€‚</li>
</ol>
<p>ä½†æ˜¯ä¸å¼€å¯swapï¼Œä¼šé€ æˆå¾ˆä¸¥é‡çš„åæœï¼š</p>
<ol>
<li>å†…å­˜ä½¿ç”¨æ³¢åŠ¨çš„æ—¶å€™ä¼šå¯¼è‡´ç³»ç»Ÿç›´æ¥æ€æ­»æŸäº›è¿›ç¨‹ï¼Œé€ æˆä¸¥é‡çš„ç³»ç»Ÿä¸ç¨³å®šå› ç´ ï¼Œè§¦å‘åªæ˜¯å› ä¸ºç³»ç»Ÿå¶å°”çš„ä¸€æ¬¡æ³¢åŠ¨è€Œå·²ã€‚</li>
</ol>
<h2 id="å¼€å¯swapçš„æ–¹æ³•"><a href="#å¼€å¯swapçš„æ–¹æ³•" class="headerlink" title="å¼€å¯swapçš„æ–¹æ³•"></a>å¼€å¯swapçš„æ–¹æ³•</h2><h3 id="åˆ›å»ºç”¨äºäº¤æ¢åˆ†åŒºçš„æ–‡ä»¶"><a href="#åˆ›å»ºç”¨äºäº¤æ¢åˆ†åŒºçš„æ–‡ä»¶" class="headerlink" title="åˆ›å»ºç”¨äºäº¤æ¢åˆ†åŒºçš„æ–‡ä»¶"></a>åˆ›å»ºç”¨äºäº¤æ¢åˆ†åŒºçš„æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=/mnt/swap bs=1M count=4096</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼š<code>block_size</code>ã€<code>number_of_block</code>å¤§å°å¯ä»¥è‡ªå®šä¹‰ï¼Œæ¯”å¦‚bs=1M count=4096ä»£è¡¨è®¾ç½®4Gå¤§å°swapåˆ†åŒº</p>
<h3 id="è®¾ç½®äº¤æ¢åˆ†åŒºæ–‡ä»¶"><a href="#è®¾ç½®äº¤æ¢åˆ†åŒºæ–‡ä»¶" class="headerlink" title="è®¾ç½®äº¤æ¢åˆ†åŒºæ–‡ä»¶"></a>è®¾ç½®äº¤æ¢åˆ†åŒºæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkswap /mnt/swap</span><br></pre></td></tr></table></figure>

<h3 id="ç«‹å³å¯ç”¨äº¤æ¢åˆ†åŒºæ–‡ä»¶"><a href="#ç«‹å³å¯ç”¨äº¤æ¢åˆ†åŒºæ–‡ä»¶" class="headerlink" title="ç«‹å³å¯ç”¨äº¤æ¢åˆ†åŒºæ–‡ä»¶"></a>ç«‹å³å¯ç”¨äº¤æ¢åˆ†åŒºæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon /mnt/swap</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨/etc/rc.localä¸­æœ‰swapoff -a éœ€è¦ä¿®æ”¹ä¸ºswapon -a</p>
<h3 id="è®¾ç½®å¼€æœºæ—¶è‡ªå¯ç”¨swapåˆ†åŒº"><a href="#è®¾ç½®å¼€æœºæ—¶è‡ªå¯ç”¨swapåˆ†åŒº" class="headerlink" title="è®¾ç½®å¼€æœºæ—¶è‡ªå¯ç”¨swapåˆ†åŒº"></a>è®¾ç½®å¼€æœºæ—¶è‡ªå¯ç”¨swapåˆ†åŒº</h3><p>éœ€è¦ä¿®æ”¹æ–‡ä»¶/etc/fstabä¸­çš„swapè¡Œã€‚æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;mnt&#x2F;swap swap swap defaults 0 0</span><br></pre></td></tr></table></figure>
<p>æ³¨ï¼š/mnt/swap è·¯å¾„å¯ä»¥ä¿®æ”¹ï¼Œå¯ä»¥æ ¹æ®åˆ›å»ºçš„swapæ–‡ä»¶å…·ä½“è·¯å¾„æ¥é…ç½®ã€‚</p>
<p>è®¾ç½®åå¯ä»¥æ‰§è¡Œfree -må‘½ä»¤æŸ¥çœ‹æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@www:~# free -m</span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          7983       7784        199          2         70       1158</span><br><span class="line">-&#x2F;+ buffers&#x2F;cache:       6555       1428</span><br><span class="line">Swap:         4095       1052       3043</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-26-turn-on-swap-on-aliyun-linux/" data-id="cklf7tstj002cz8t4ecv83h3n" data-title="é˜¿é‡Œäº‘ECS Linuxå¼€å¯swapï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ECS/" rel="tag">ECS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swap/" rel="tag">swap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" rel="tag">é˜¿é‡Œäº‘</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-08-30-mysql-performance-and-tunning" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-08-30-mysql-performance-and-tunning/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-08-30-mysql-performance-and-tunning/">MySQLæ€§èƒ½æŸ¥çœ‹åŠè°ƒä¼˜å‚è€ƒ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ç½‘ä¸Šæœ‰å¾ˆå¤šçš„æ–‡ç« æ•™æ€ä¹ˆé…ç½®MySQLæœåŠ¡å™¨ï¼Œä½†è€ƒè™‘åˆ°æœåŠ¡å™¨ç¡¬ä»¶é…ç½®çš„ä¸åŒï¼Œå…·ä½“åº”ç”¨çš„å·®åˆ«ï¼Œé‚£äº›æ–‡ç« çš„åšæ³•åªèƒ½ä½œä¸ºåˆæ­¥è®¾ç½®å‚è€ƒï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„æƒ…å†µè¿›è¡Œé…ç½®ä¼˜åŒ–ï¼Œå¥½çš„åšæ³•æ˜¯MySQLæœåŠ¡å™¨ç¨³å®šè¿è¡Œäº†ä¸€æ®µæ—¶é—´åè¿è¡Œï¼Œæ ¹æ®æœåŠ¡å™¨çš„â€çŠ¶æ€â€è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>ä¸»è¦ä¾èµ–ä¸¤ä¸ªå‘½ä»¤ï¼Œ1ï¼‰å¯ä»¥åˆ—å‡ºMySQLæœåŠ¡å™¨è¿è¡Œå„ç§çŠ¶æ€å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status;</span><br></pre></td></tr></table></figure>
<p>2ï¼‰æŸ¥è¯¢MySQLæœåŠ¡å™¨é…ç½®ä¿¡æ¯è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables;</span><br></pre></td></tr></table></figure>

<h2 id="æ…¢æŸ¥è¯¢"><a href="#æ…¢æŸ¥è¯¢" class="headerlink" title="æ…¢æŸ¥è¯¢"></a>æ…¢æŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> Variable_name <span class="keyword">like</span> <span class="string">&#x27;%slow_query_log%&#x27;</span> <span class="keyword">or</span> Variable_name <span class="keyword">like</span> <span class="string">&#x27;long_query%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+-------------------------+</span><br><span class="line">| Variable_name       | Value                   |</span><br><span class="line">+---------------------+-------------------------+</span><br><span class="line">| long_query_time     | 5.000000                |</span><br><span class="line">| slow_query_log      | ON                      |</span><br><span class="line">| slow_query_log_file | &#x2F;var&#x2F;log&#x2F;mysql&#x2F;slow.log |</span><br><span class="line">+---------------------+-------------------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;%slow%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+-------+</span><br><span class="line">| Variable_name       | Value |</span><br><span class="line">+---------------------+-------+</span><br><span class="line">| Slow_launch_threads | 0     |</span><br><span class="line">| Slow_queries        | 457   |</span><br><span class="line">+---------------------+-------+</span><br></pre></td></tr></table></figure>
<p>é…ç½®ä¸­æ‰“å¼€äº†è®°å½•æ…¢æŸ¥è¯¢ï¼Œæ‰§è¡Œæ—¶é—´è¶…è¿‡5ç§’çš„å³ä¸ºæ…¢æŸ¥è¯¢ï¼Œç³»ç»Ÿæ˜¾ç¤ºæœ‰457ä¸ªæ…¢æŸ¥è¯¢ï¼Œä½ å¯ä»¥åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾å‡ºæœ‰é—®é¢˜çš„SQLè¯­å¥ï¼Œæ…¢æŸ¥è¯¢æ—¶é—´ä¸å®œè®¾ç½®è¿‡é•¿ï¼Œå¦åˆ™æ„ä¹‰ä¸å¤§ï¼Œæœ€å¥½åœ¨5ç§’ä»¥å†…ã€‚</p>
<p><strong>Hintï¼š</strong>æ‰“å¼€æ…¢æŸ¥è¯¢æ—¥å¿—å¯èƒ½ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½æœ‰ä¸€ç‚¹ç‚¹å½±å“ï¼Œå¦‚æœä½ çš„MySQLæ˜¯ä¸»-ä»ç»“æ„ï¼Œå¯ä»¥è€ƒè™‘æ‰“å¼€å…¶ä¸­ä¸€å°ä»æœåŠ¡å™¨çš„æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè¿™æ ·æ—¢å¯ä»¥ç›‘æ§æ…¢æŸ¥è¯¢ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½å½±å“åˆå°ã€‚</p>
<h2 id="è¿æ¥æ•°"><a href="#è¿æ¥æ•°" class="headerlink" title="è¿æ¥æ•°"></a>è¿æ¥æ•°</h2><p>ç»å¸¸ä¼šé‡è§â€MySQL: ERROR 1040: Too many connectionsâ€çš„æƒ…å†µï¼Œä¸€ç§æ˜¯è®¿é—®é‡ç¡®å®å¾ˆé«˜ï¼ŒMySQLæœåŠ¡å™¨æŠ—ä¸ä½ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦è€ƒè™‘å¢åŠ ä»æœåŠ¡å™¨åˆ†æ•£è¯»å‹åŠ›ï¼Œå¦å¤–ä¸€ç§æƒ…å†µæ˜¯MySQLé…ç½®æ–‡ä»¶ä¸­max_connectionså€¼è¿‡å°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;max_connections&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-----------------+-------+</span><br><span class="line">| Variable_name   | Value |</span><br><span class="line">+-----------------+-------+</span><br><span class="line">| max_connections | 1000  |</span><br><span class="line">+-----------------+-------+</span><br></pre></td></tr></table></figure>
<p>è¿™å°MySQLæœåŠ¡å™¨æœ€å¤§è¿æ¥æ•°æ˜¯1000ï¼Œç„¶åæŸ¥è¯¢ä¸€ä¸‹æœåŠ¡å™¨å“åº”çš„æœ€å¤§è¿æ¥æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Max_used_connections&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name        | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Max_used_connections | 299   |</span><br><span class="line">+----------------------+-------+</span><br></pre></td></tr></table></figure>

<p>MySQLæœåŠ¡å™¨è¿‡å»çš„æœ€å¤§è¿æ¥æ•°æ˜¯299ï¼Œæ²¡æœ‰è¾¾åˆ°æœåŠ¡å™¨è¿æ¥æ•°ä¸Šé™1000ï¼Œåº”è¯¥æ²¡æœ‰å‡ºç°1040é”™è¯¯ï¼Œæ¯”è¾ƒç†æƒ³çš„è®¾ç½®æ˜¯ï¼š</p>
<blockquote>
<p>Max_used_connections / max_connections * 100% â‰ˆ 85%</p>
</blockquote>
<p>æœ€å¤§è¿æ¥æ•°å ä¸Šé™è¿æ¥æ•°çš„85%å·¦å³ï¼Œå¦‚æœå‘ç°æ¯”ä¾‹åœ¨10%ä»¥ä¸‹ï¼ŒMySQLæœåŠ¡å™¨è¿æ¥æ•°ä¸Šé™è®¾ç½®çš„è¿‡é«˜äº†ã€‚</p>
<h2 id="ä¸´æ—¶è¡¨"><a href="#ä¸´æ—¶è¡¨" class="headerlink" title="ä¸´æ—¶è¡¨"></a>ä¸´æ—¶è¡¨</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;created_tmp%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------+--------+</span><br><span class="line">| Variable_name           | Value  |</span><br><span class="line">+-------------------------+--------+</span><br><span class="line">| Created_tmp_disk_tables | 15259  |</span><br><span class="line">| Created_tmp_files       | 3237   |</span><br><span class="line">| Created_tmp_tables      | 244972 |</span><br><span class="line">+-------------------------+--------+</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡åˆ›å»ºä¸´æ—¶è¡¨ï¼ŒCreated_tmp_tableså¢åŠ ï¼Œå¦‚æœæ˜¯åœ¨ç£ç›˜ä¸Šåˆ›å»ºä¸´æ—¶è¡¨ï¼ŒCreated_tmp_disk_tablesä¹Ÿå¢åŠ ,Created_tmp_filesè¡¨ç¤ºMySQLæœåŠ¡åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶æ–‡ä»¶æ•°ï¼Œæ¯”è¾ƒç†æƒ³çš„é…ç½®æ˜¯ï¼š</p>
<blockquote>
<p>Created_tmp_disk_tables / Created_tmp_tables * 100% &lt;= 25%</p>
</blockquote>
<p>æ¯”å¦‚ä¸Šé¢çš„æœåŠ¡å™¨Created_tmp_disk_tables / Created_tmp_tables * 100% = 6.2%ï¼Œåº”è¯¥å¯ä»¥äº†ã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹MySQLæœåŠ¡å™¨å¯¹ä¸´æ—¶è¡¨çš„é…ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> Variable_name <span class="keyword">in</span> (<span class="string">&#x27;tmp_table_size&#x27;</span>, <span class="string">&#x27;max_heap_table_size&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+----------+</span><br><span class="line">| Variable_name       | Value    |</span><br><span class="line">+---------------------+----------+</span><br><span class="line">| max_heap_table_size | 16777216 |</span><br><span class="line">| tmp_table_size      | 16777216 |</span><br><span class="line">+---------------------+----------+</span><br></pre></td></tr></table></figure>
<p>åªæœ‰16MBä»¥ä¸‹çš„ä¸´æ—¶è¡¨æ‰èƒ½å…¨éƒ¨æ”¾å†…å­˜ï¼Œè¶…è¿‡çš„å°±ä¼šç”¨åˆ°ç¡¬ç›˜ä¸´æ—¶è¡¨ã€‚</p>
<h2 id="Open-Tableæƒ…å†µ"><a href="#Open-Tableæƒ…å†µ" class="headerlink" title="Open Tableæƒ…å†µ"></a>Open Tableæƒ…å†µ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;open%tables%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Open_tables   | 953   |</span><br><span class="line">| Opened_tables | 1935  |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure>
<p>Open_tablesè¡¨ç¤ºæ‰“å¼€è¡¨çš„æ•°é‡ï¼ŒOpened_tablesè¡¨ç¤ºæ‰“å¼€è¿‡çš„è¡¨æ•°é‡ï¼Œå¦‚æœOpened_tablesæ•°é‡è¿‡å¤§ï¼Œè¯´æ˜é…ç½®ä¸­table_cache(5.1.3ä¹‹åè¿™ä¸ªå€¼å«åštable_open_cache)å€¼å¯èƒ½å¤ªå°ï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹æœåŠ¡å™¨table_cacheå€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%table_open%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----------------------------+-------+</span><br><span class="line">| Variable_name              | Value |</span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| table_open_cache           | 2000  |</span><br><span class="line">| table_open_cache_instances | 1     |</span><br><span class="line">+----------------------------+-------+</span><br></pre></td></tr></table></figure>
<p>æ¯”è¾ƒåˆé€‚çš„å€¼ä¸ºï¼š</p>
<blockquote>
<p>Open_tables / Opened_tables * 100% &gt;= 85%<br>Open_tables / table_open_cache * 100% &lt;= 95%</p>
</blockquote>
<h2 id="è¿›ç¨‹ä½¿ç”¨æƒ…å†µ"><a href="#è¿›ç¨‹ä½¿ç”¨æƒ…å†µ" class="headerlink" title="è¿›ç¨‹ä½¿ç”¨æƒ…å†µ"></a>è¿›ç¨‹ä½¿ç”¨æƒ…å†µ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;Thread%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Threads_cached    | 1     |</span><br><span class="line">| Threads_connected | 280   |</span><br><span class="line">| Threads_created   | 12368 |</span><br><span class="line">| Threads_running   | 2     |</span><br><span class="line">+-------------------+-------+</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬åœ¨MySQLæœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº†thread_cache_sizeï¼Œå½“å®¢æˆ·ç«¯æ–­å¼€ä¹‹åï¼ŒæœåŠ¡å™¨å¤„ç†æ­¤å®¢æˆ·çš„çº¿ç¨‹å°†ä¼šç¼“å­˜èµ·æ¥ä»¥å“åº”ä¸‹ä¸€ä¸ªå®¢æˆ·è€Œä¸æ˜¯é”€æ¯(å‰ææ˜¯ç¼“å­˜æ•°æœªè¾¾ä¸Šé™)ã€‚Threads_createdè¡¨ç¤ºåˆ›å»ºè¿‡çš„çº¿ç¨‹æ•°ï¼Œå¦‚æœå‘ç°Threads_createdå€¼è¿‡å¤§çš„è¯ï¼Œè¡¨æ˜MySQLæœåŠ¡å™¨ä¸€ç›´åœ¨åˆ›å»ºçº¿ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒè€—èµ„æºï¼Œå¯ä»¥é€‚å½“å¢åŠ é…ç½®æ–‡ä»¶ä¸­thread_cache_sizeå€¼ï¼ŒæŸ¥è¯¢æœåŠ¡å™¨thread_cache_sizeé…ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;thread_cache_size&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| thread_cache_size | 64    |</span><br><span class="line">+-------------------+-------+</span><br></pre></td></tr></table></figure>

<h2 id="æ’åºä½¿ç”¨æƒ…å†µ"><a href="#æ’åºä½¿ç”¨æƒ…å†µ" class="headerlink" title="æ’åºä½¿ç”¨æƒ…å†µ"></a>æ’åºä½¿ç”¨æƒ…å†µ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;sort%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+----------+</span><br><span class="line">| Variable_name     | Value    |</span><br><span class="line">+-------------------+----------+</span><br><span class="line">| Sort_merge_passes | 1012     |</span><br><span class="line">| Sort_range        | 519624   |</span><br><span class="line">| Sort_rows         | 14179389 |</span><br><span class="line">| Sort_scan         | 846266   |</span><br><span class="line">+-------------------+----------+</span><br></pre></td></tr></table></figure>

<p>Sort_merge_passes åŒ…æ‹¬ä¸¤æ­¥ã€‚MySQL é¦–å…ˆä¼šå°è¯•åœ¨å†…å­˜ä¸­åšæ’åºï¼Œä½¿ç”¨çš„å†…å­˜å¤§å°ç”±ç³»ç»Ÿå˜é‡ Sort_buffer_size å†³å®šï¼Œå¦‚æœå®ƒçš„å¤§å°ä¸å¤ŸæŠŠæ‰€æœ‰çš„è®°å½•éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼ŒMySQL å°±ä¼šæŠŠæ¯æ¬¡åœ¨å†…å­˜ä¸­æ’åºçš„ç»“æœå­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œç­‰ MySQL æ‰¾åˆ°æ‰€æœ‰è®°å½•ä¹‹åï¼Œå†æŠŠä¸´æ—¶æ–‡ä»¶ä¸­çš„è®°å½•åšä¸€æ¬¡æ’åºã€‚è¿™å†æ¬¡æ’åºå°±ä¼šå¢åŠ  Sort_merge_passesã€‚å®é™…ä¸Šï¼ŒMySQL ä¼šç”¨å¦ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶æ¥å­˜å†æ¬¡æ’åºçš„ç»“æœï¼Œæ‰€ä»¥é€šå¸¸ä¼šçœ‹åˆ° Sort_merge_passes å¢åŠ çš„æ•°å€¼æ˜¯å»ºä¸´æ—¶æ–‡ä»¶æ•°çš„ä¸¤å€ã€‚å› ä¸ºç”¨åˆ°äº†ä¸´æ—¶æ–‡ä»¶ï¼Œæ‰€ä»¥é€Ÿåº¦å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œå¢åŠ  Sort_buffer_size ä¼šå‡å°‘ Sort_merge_passes å’Œ åˆ›å»ºä¸´æ—¶æ–‡ä»¶çš„æ¬¡æ•°ã€‚</p>
<p>å¦å¤–ï¼Œå¢åŠ read_rnd_buffer_size(3.2.3æ˜¯record_rnd_buffer_size)çš„å€¼å¯¹æ’åºçš„æ“ä½œä¹Ÿæœ‰ä¸€ç‚¹çš„å¥½å¤„ï¼Œå‚è§ï¼š<a target="_blank" rel="noopener" href="http://www.mysqlperformanceblog.com/2007/07/24/what-exactly-is-read_rnd_buffer_size/">http://www.mysqlperformanceblog.com/2007/07/24/what-exactly-is-read_rnd_buffer_size/</a></p>
<h2 id="æ–‡ä»¶æ‰“å¼€æ•°"><a href="#æ–‡ä»¶æ‰“å¼€æ•°" class="headerlink" title="æ–‡ä»¶æ‰“å¼€æ•°"></a>æ–‡ä»¶æ‰“å¼€æ•°</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;open_files&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Open_files    | 30    |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;open_files_limit&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| open_files_limit | 65535 |</span><br><span class="line">+------------------+-------+</span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒåˆé€‚çš„è®¾ç½®ï¼š</p>
<blockquote>
<p>Open_files / open_files_limit * 100% &lt;= 75%</p>
</blockquote>
<h2 id="è¡¨æ‰«ææƒ…å†µ"><a href="#è¡¨æ‰«ææƒ…å†µ" class="headerlink" title="è¡¨æ‰«ææƒ…å†µ"></a>è¡¨æ‰«ææƒ…å†µ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;handler_read%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------+-------------+</span><br><span class="line">| Variable_name         | Value       |</span><br><span class="line">+-----------------------+-------------+</span><br><span class="line">| Handler_read_first    | 8525687     |</span><br><span class="line">| Handler_read_key      | 192321231   |</span><br><span class="line">| Handler_read_last     | 120         |</span><br><span class="line">| Handler_read_next     | 351154252   |</span><br><span class="line">| Handler_read_prev     | 46717985    |</span><br><span class="line">| Handler_read_rnd      | 13564471    |</span><br><span class="line">| Handler_read_rnd_next | 44813383354 |</span><br><span class="line">+-----------------------+-------------+</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡å™¨å®Œæˆçš„æŸ¥è¯¢è¯·æ±‚æ¬¡æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;com_select&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------------+----------+</span><br><span class="line">| Variable_name | Value    |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| Com_select    | 27320750 |</span><br><span class="line">+---------------+----------+</span><br></pre></td></tr></table></figure>

<p>è®¡ç®—è¡¨æ‰«æç‡ï¼š</p>
<blockquote>
<p>è¡¨æ‰«æç‡ = Handler_read_rnd_next / Com_select</p>
</blockquote>
<p>å¦‚æœè¡¨æ‰«æç‡è¶…è¿‡4000ï¼Œè¯´æ˜è¿›è¡Œäº†å¤ªå¤šè¡¨æ‰«æï¼Œå¾ˆæœ‰å¯èƒ½ç´¢å¼•æ²¡æœ‰å»ºå¥½ï¼Œå¢åŠ read_buffer_sizeå€¼ä¼šæœ‰ä¸€äº›å¥½å¤„ï¼Œä½†æœ€å¥½ä¸è¦è¶…è¿‡8MBã€‚</p>
<h2 id="è¡¨é”æƒ…å†µ"><a href="#è¡¨é”æƒ…å†µ" class="headerlink" title="è¡¨é”æƒ…å†µ"></a>è¡¨é”æƒ…å†µ</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;table_locks%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------+----------+</span><br><span class="line">| Variable_name         | Value    |</span><br><span class="line">+-----------------------+----------+</span><br><span class="line">| Table_locks_immediate | 28770420 |</span><br><span class="line">| Table_locks_waited    | 0        |</span><br><span class="line">+-----------------------+----------+</span><br></pre></td></tr></table></figure>
<p>Table_locks_immediateè¡¨ç¤ºç«‹å³é‡Šæ”¾è¡¨é”æ•°ï¼ŒTable_locks_waitedè¡¨ç¤ºéœ€è¦ç­‰å¾…çš„è¡¨é”æ•°ï¼Œå¦‚æœTable_locks_immediate / Table_locks_waited &gt; 5000ï¼Œæœ€å¥½é‡‡ç”¨InnoDBå¼•æ“ï¼Œå› ä¸ºInnoDBæ˜¯è¡Œé”è€ŒMyISAMæ˜¯è¡¨é”ï¼Œå¯¹äºé«˜å¹¶å‘å†™å…¥çš„åº”ç”¨InnoDBæ•ˆæœä¼šå¥½äº›ã€‚ç¤ºä¾‹ä¸­çš„æœåŠ¡å™¨Table_locks_immediate / Table_locks_waited = 235ï¼ŒMyISAMå°±è¶³å¤Ÿäº†ã€‚</p>
<h2 id="Key-buffer-size"><a href="#Key-buffer-size" class="headerlink" title="Key_buffer_size"></a>Key_buffer_size</h2><p>key_buffer_sizeæ˜¯å¯¹MyISAMè¡¨æ€§èƒ½å½±å“æœ€å¤§çš„ä¸€ä¸ªå‚æ•°ï¼Œä¸‹é¢ä¸€å°ä»¥MyISAMä¸ºä¸»è¦å­˜å‚¨å¼•æ“æœåŠ¡å™¨çš„é…ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;key_buffer_size&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-----------------+----------+</span><br><span class="line">| Variable_name   | Value    |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| key_buffer_size | 16777216 |</span><br><span class="line">+-----------------+----------+</span><br></pre></td></tr></table></figure>

<p>åˆ†é…äº†16MBå†…å­˜ç»™key_buffer_sizeï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹key_buffer_sizeçš„ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;key_read%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Key_read_requests | 31424 |</span><br><span class="line">| Key_reads         | 4     |</span><br><span class="line">+-------------------+-------+</span><br></pre></td></tr></table></figure>

<p>ä¸€å…±æœ‰31424ä¸ªç´¢å¼•è¯»å–è¯·æ±‚ï¼Œæœ‰4ä¸ªè¯·æ±‚åœ¨å†…å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç›´æ¥ä»ç¡¬ç›˜è¯»å–ç´¢å¼•ï¼Œè®¡ç®—ç´¢å¼•æœªå‘½ä¸­ç¼“å­˜çš„æ¦‚ç‡ï¼š</p>
<blockquote>
<p>key_cache_miss_rate = Key_reads / Key_read_requests * 100%</p>
</blockquote>
<p>æ¯”å¦‚ä¸Šé¢çš„æ•°æ®ï¼Œkey_cache_miss_rateä¸º0.0244%ï¼Œ4000ä¸ªç´¢å¼•è¯»å–è¯·æ±‚æ‰æœ‰ä¸€ä¸ªç›´æ¥è¯»ç¡¬ç›˜ï¼Œå·²ç»å¾ˆBTäº†,key_cache_miss_rateåœ¨0.1%ä»¥ä¸‹éƒ½å¾ˆå¥½(æ¯1000ä¸ªè¯·æ±‚æœ‰ä¸€ä¸ªç›´æ¥è¯»ç¡¬ç›˜)ï¼Œå¦‚æœkey_cache_miss_rateåœ¨0.01%ä»¥ä¸‹çš„è¯ï¼Œkey_buffer_sizeåˆ†é…çš„è¿‡å¤šï¼Œå¯ä»¥é€‚å½“å‡å°‘ã€‚</p>
<p>MySQLæœåŠ¡å™¨è¿˜æä¾›äº†key_blocks_*å‚æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;key_blocks_u%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+-------+</span><br><span class="line">| Variable_name     | Value |</span><br><span class="line">+-------------------+-------+</span><br><span class="line">| Key_blocks_unused | 13392 |</span><br><span class="line">| Key_blocks_used   | 51    |</span><br><span class="line">+-------------------+-------+</span><br></pre></td></tr></table></figure>

<p>Key_blocks_unusedè¡¨ç¤ºæœªä½¿ç”¨çš„ç¼“å­˜ç°‡(blocks)æ•°ï¼ŒKey_blocks_usedè¡¨ç¤ºæ›¾ç»ç”¨åˆ°çš„æœ€å¤§çš„blocksæ•°ï¼Œæ¯”å¦‚è¿™å°æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„ç¼“å­˜éƒ½ç”¨åˆ°äº†ï¼Œè¦ä¹ˆå¢åŠ key_buffer_sizeï¼Œè¦ä¹ˆå°±æ˜¯è¿‡æ¸¡ç´¢å¼•äº†ï¼ŒæŠŠç¼“å­˜å æ»¡äº†ã€‚æ¯”è¾ƒç†æƒ³çš„è®¾ç½®ï¼š</p>
<blockquote>
<p>Key_blocks_used / (Key_blocks_unused + Key_blocks_used) * 100% â‰ˆ 80%</p>
</blockquote>
<h2 id="æŸ¥è¯¢ç¼“å­˜-query-cache"><a href="#æŸ¥è¯¢ç¼“å­˜-query-cache" class="headerlink" title="æŸ¥è¯¢ç¼“å­˜(query cache)"></a>æŸ¥è¯¢ç¼“å­˜(query cache)</h2><p><strong>æ³¨æ„ï¼š</strong>å¾ˆå¤šäººä¸å»ºè®®å¯¹è¿™ä¸ªé€‰é¡¹è°ƒä¼˜ï¼Œæ‰€ä»¥æ”¾åˆ°äº†æœ€åã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;qcache%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------+----------+</span><br><span class="line">| Variable_name           | Value    |</span><br><span class="line">+-------------------------+----------+</span><br><span class="line">| Qcache_free_blocks      | 1        |</span><br><span class="line">| Qcache_free_memory      | 1031360  |</span><br><span class="line">| Qcache_hits             | 0        |</span><br><span class="line">| Qcache_inserts          | 0        |</span><br><span class="line">| Qcache_lowmem_prunes    | 0        |</span><br><span class="line">| Qcache_not_cached       | 27326355 |</span><br><span class="line">| Qcache_queries_in_cache | 0        |</span><br><span class="line">| Qcache_total_blocks     | 1        |</span><br><span class="line">+-------------------------+----------+</span><br></pre></td></tr></table></figure>

<p>MySQLæŸ¥è¯¢ç¼“å­˜å˜é‡è§£é‡Šï¼š</p>
<ul>
<li>Qcache_free_blocksï¼šç¼“å­˜ä¸­ç›¸é‚»å†…å­˜å—çš„ä¸ªæ•°ã€‚æ•°ç›®å¤§è¯´æ˜å¯èƒ½æœ‰ç¢ç‰‡ã€‚FLUSH QUERY CACHEä¼šå¯¹ç¼“å­˜ä¸­çš„ç¢ç‰‡è¿›è¡Œæ•´ç†ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªç©ºé—²å—ã€‚</li>
<li>Qcache_free_memoryï¼šç¼“å­˜ä¸­çš„ç©ºé—²å†…å­˜ã€‚ </li>
<li>Qcache_hitsï¼šæ¯æ¬¡æŸ¥è¯¢åœ¨ç¼“å­˜ä¸­å‘½ä¸­æ—¶å°±å¢å¤§</li>
<li>Qcache_insertsï¼šæ¯æ¬¡æ’å…¥ä¸€ä¸ªæŸ¥è¯¢æ—¶å°±å¢å¤§ã€‚å‘½ä¸­æ¬¡æ•°é™¤ä»¥æ’å…¥æ¬¡æ•°å°±æ˜¯ä¸ä¸­æ¯”ç‡ã€‚</li>
<li>Qcache_lowmem_prunesï¼šç¼“å­˜å‡ºç°å†…å­˜ä¸è¶³å¹¶ä¸”å¿…é¡»è¦è¿›è¡Œæ¸…ç†ä»¥ä¾¿ä¸ºæ›´å¤šæŸ¥è¯¢æä¾›ç©ºé—´çš„æ¬¡æ•°ã€‚è¿™ä¸ªæ•°å­—æœ€å¥½é•¿æ—¶é—´æ¥çœ‹;å¦‚æœè¿™ä¸ªæ•°å­—åœ¨ä¸æ–­å¢é•¿ï¼Œå°±è¡¨ç¤ºå¯èƒ½ç¢ç‰‡éå¸¸ä¸¥é‡ï¼Œæˆ–è€…å†…å­˜å¾ˆå°‘ã€‚(ä¸Šé¢çš„ free_blockså’Œfree_memoryå¯ä»¥å‘Šè¯‰æ‚¨å±äºå“ªç§æƒ…å†µ) </li>
<li>Qcache_not_cachedï¼šä¸é€‚åˆè¿›è¡Œç¼“å­˜çš„æŸ¥è¯¢çš„æ•°é‡ï¼Œé€šå¸¸æ˜¯ç”±äºè¿™äº›æŸ¥è¯¢ä¸æ˜¯ SELECT è¯­å¥æˆ–è€…ç”¨äº†now()ä¹‹ç±»çš„å‡½æ•°ã€‚</li>
<li>Qcache_queries_in_cacheï¼šå½“å‰ç¼“å­˜çš„æŸ¥è¯¢(å’Œå“åº”)çš„æ•°é‡ã€‚</li>
<li>Qcache_total_blocksï¼šç¼“å­˜ä¸­å—çš„æ•°é‡ã€‚</li>
</ul>
<p>æˆ‘ä»¬å†æŸ¥è¯¢ä¸€ä¸‹æœåŠ¡å™¨å…³äºquery_cacheçš„é…ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;query_cache%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------+---------+</span><br><span class="line">| Variable_name                | Value   |</span><br><span class="line">+------------------------------+---------+</span><br><span class="line">| query_cache_limit            | 1048576 |</span><br><span class="line">| query_cache_min_res_unit     | 4096    |</span><br><span class="line">| query_cache_size             | 1048576 |</span><br><span class="line">| query_cache_type             | OFF     |</span><br><span class="line">| query_cache_wlock_invalidate | OFF     |</span><br><span class="line">+------------------------------+---------+</span><br></pre></td></tr></table></figure>
<p>å„å­—æ®µçš„è§£é‡Šï¼š</p>
<ul>
<li>query_cache_limitï¼šè¶…è¿‡æ­¤å¤§å°çš„æŸ¥è¯¢å°†ä¸ç¼“å­˜</li>
<li>query_cache_min_res_unitï¼šç¼“å­˜å—çš„æœ€å°å¤§å°</li>
<li>query_cache_sizeï¼šæŸ¥è¯¢ç¼“å­˜å¤§å°</li>
<li>query_cache_typeï¼šç¼“å­˜ç±»å‹ï¼Œå†³å®šç¼“å­˜ä»€ä¹ˆæ ·çš„æŸ¥è¯¢ï¼Œç¤ºä¾‹ä¸­è¡¨ç¤ºä¸ç¼“å­˜ select sql_no_cache æŸ¥è¯¢</li>
<li>query_cache_wlock_invalidateï¼šå½“æœ‰å…¶ä»–å®¢æˆ·ç«¯æ­£åœ¨å¯¹MyISAMè¡¨è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå¦‚æœæŸ¥è¯¢åœ¨query cacheä¸­ï¼Œæ˜¯å¦è¿”å›cacheç»“æœè¿˜æ˜¯ç­‰å†™æ“ä½œå®Œæˆå†è¯»è¡¨è·å–ç»“æœã€‚</li>
<li>query_cache_min_res_unitçš„é…ç½®æ˜¯ä¸€æŸ„â€åŒåˆƒå‰‘â€ï¼Œé»˜è®¤æ˜¯4KBï¼Œè®¾ç½®å€¼å¤§å¯¹å¤§æ•°æ®æŸ¥è¯¢æœ‰å¥½å¤„ï¼Œä½†å¦‚æœä½ çš„æŸ¥è¯¢éƒ½æ˜¯å°æ•°æ®æŸ¥è¯¢ï¼Œå°±å®¹æ˜“é€ æˆå†…å­˜ç¢ç‰‡å’Œæµªè´¹ã€‚</li>
<li>æŸ¥è¯¢ç¼“å­˜ç¢ç‰‡ç‡ = Qcache_free_blocks / Qcache_total_blocks * 100%</li>
<li>å¦‚æœæŸ¥è¯¢ç¼“å­˜ç¢ç‰‡ç‡è¶…è¿‡20%ï¼Œå¯ä»¥ç”¨FLUSH QUERY CACHEæ•´ç†ç¼“å­˜ç¢ç‰‡ï¼Œæˆ–è€…è¯•è¯•å‡å°query_cache_min_res_unitï¼Œå¦‚æœä½ çš„æŸ¥è¯¢éƒ½æ˜¯å°æ•°æ®é‡çš„è¯ã€‚</li>
<li>æŸ¥è¯¢ç¼“å­˜åˆ©ç”¨ç‡ = (query_cache_size - Qcache_free_memory) / query_cache_size * 100%</li>
<li>æŸ¥è¯¢ç¼“å­˜åˆ©ç”¨ç‡åœ¨25%ä»¥ä¸‹çš„è¯è¯´æ˜query_cache_sizeè®¾ç½®çš„è¿‡å¤§ï¼Œå¯é€‚å½“å‡å°;æŸ¥è¯¢ç¼“å­˜åˆ©ç”¨ç‡åœ¨80%ä»¥ä¸Šè€Œä¸”Qcache_lowmem_prunes &gt; 50çš„è¯è¯´æ˜query_cache_sizeå¯èƒ½æœ‰ç‚¹å°ï¼Œè¦ä¸å°±æ˜¯ç¢ç‰‡å¤ªå¤šã€‚</li>
<li>æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ = (Qcache_hits - Qcache_inserts) / Qcache_hits * 100%</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-08-30-mysql-performance-and-tunning/" data-id="cklf7tstk002ez8t41ti5g4i9" data-title="MySQLæ€§èƒ½æŸ¥çœ‹åŠè°ƒä¼˜å‚è€ƒ" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Performance/" rel="tag">Performance</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tuning/" rel="tag">Tuning</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Microservice/">Microservice</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Microservice/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">å¾®æœåŠ¡</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%9C%8D%E5%8A%A1%E5%99%A8/">WebæœåŠ¡å™¨</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">å…¶ä»–</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93/">å®‰å“</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%99%9A%E6%8B%9F%E5%8C%96/">è™šæ‹ŸåŒ–</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">è¿ç»´</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Service/" rel="tag">Android Service</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bash/" rel="tag">Bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binlog/" rel="tag">Binlog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Browser-Caching/" rel="tag">Browser Caching</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPU/" rel="tag">CPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cobar/" rel="tag">Cobar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECS/" rel="tag">ECS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Email/" rel="tag">Email</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emoji/" rel="tag">Emoji</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GTID/" rel="tag">GTID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Goaccess/" rel="tag">Goaccess</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gzip/" rel="tag">Gzip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/" rel="tag">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Introduction-to-Microservices/" rel="tag">Introduction to Microservices</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/" rel="tag">JDK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JUnit/" rel="tag">JUnit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Mail/" rel="tag">Java Mail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaMail/" rel="tag">JavaMail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jedis/" rel="tag">Jedis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Marathon/" rel="tag">Marathon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mesos/" rel="tag">Mesos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/" rel="tag">Mockito</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Moint/" rel="tag">Moint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mongo/" rel="tag">Mongo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyCAT/" rel="tag">MyCAT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORM/" rel="tag">ORM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PowerMock/" rel="tag">PowerMock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMTP/" rel="tag">SMTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Script/" rel="tag">Script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/" rel="tag">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Data-JPA/" rel="tag">Spring Data JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Modules/" rel="tag">Spring Modules</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Telnet/" rel="tag">Telnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tuning/" rel="tag">Tuning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/USB/" rel="tag">USB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Volumes/" rel="tag">Volumes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/" rel="tag">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apk/" rel="tag">apk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emoji/" rel="tag">emoji</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/enca/" rel="tag">enca</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysqldump/" rel="tag">mysqldump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swap/" rel="tag">swap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utf8mb4/" rel="tag">utf8mb4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">ä¸­é—´ä»¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" rel="tag">ä¸»ä»å¤åˆ¶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" rel="tag">åˆ†å¸ƒå¼é”</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" rel="tag">åˆ†åº“åˆ†è¡¨</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="tag">å•å…ƒæµ‹è¯•</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">å®‰å“</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BA%8F%E5%8F%B7%E7%94%9F%E6%88%90%E5%99%A8/" rel="tag">åºå·ç”Ÿæˆå™¨</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag">å¾®ä¿¡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">å¾®æœåŠ¡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" rel="tag">ç”µå­ä¹¦</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">ç›‘æ§</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AD%BE%E5%90%8D/" rel="tag">ç­¾å</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A0%81/" rel="tag">ç¼–ç </a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" rel="tag">è¯»å†™åˆ†ç¦»</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">è½¬è½½</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" rel="tag">é˜¿é‡Œäº‘</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Android-Service/" style="font-size: 10px;">Android Service</a> <a href="/tags/Bash/" style="font-size: 10px;">Bash</a> <a href="/tags/Binlog/" style="font-size: 10px;">Binlog</a> <a href="/tags/Browser-Caching/" style="font-size: 10px;">Browser Caching</a> <a href="/tags/CPU/" style="font-size: 10px;">CPU</a> <a href="/tags/Cobar/" style="font-size: 10px;">Cobar</a> <a href="/tags/Docker/" style="font-size: 11.67px;">Docker</a> <a href="/tags/ECS/" style="font-size: 10px;">ECS</a> <a href="/tags/Email/" style="font-size: 10px;">Email</a> <a href="/tags/Emoji/" style="font-size: 10px;">Emoji</a> <a href="/tags/GTID/" style="font-size: 11.67px;">GTID</a> <a href="/tags/Goaccess/" style="font-size: 10px;">Goaccess</a> <a href="/tags/Gzip/" style="font-size: 10px;">Gzip</a> <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/Introduction-to-Microservices/" style="font-size: 10px;">Introduction to Microservices</a> <a href="/tags/JDK/" style="font-size: 11.67px;">JDK</a> <a href="/tags/JUnit/" style="font-size: 10px;">JUnit</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 11.67px;">Java</a> <a href="/tags/Java-Mail/" style="font-size: 10px;">Java Mail</a> <a href="/tags/JavaMail/" style="font-size: 10px;">JavaMail</a> <a href="/tags/Jedis/" style="font-size: 10px;">Jedis</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Marathon/" style="font-size: 10px;">Marathon</a> <a href="/tags/Mesos/" style="font-size: 10px;">Mesos</a> <a href="/tags/Mockito/" style="font-size: 10px;">Mockito</a> <a href="/tags/Moint/" style="font-size: 10px;">Moint</a> <a href="/tags/Mongo/" style="font-size: 10px;">Mongo</a> <a href="/tags/MyCAT/" style="font-size: 11.67px;">MyCAT</a> <a href="/tags/MySQL/" style="font-size: 20px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Nodejs/" style="font-size: 10px;">Nodejs</a> <a href="/tags/ORM/" style="font-size: 10px;">ORM</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/Performance/" style="font-size: 11.67px;">Performance</a> <a href="/tags/PowerMock/" style="font-size: 10px;">PowerMock</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/SMTP/" style="font-size: 10px;">SMTP</a> <a href="/tags/Script/" style="font-size: 10px;">Script</a> <a href="/tags/Shell/" style="font-size: 11.67px;">Shell</a> <a href="/tags/Spring/" style="font-size: 16.67px;">Spring</a> <a href="/tags/Spring-Cloud/" style="font-size: 11.67px;">Spring Cloud</a> <a href="/tags/Spring-Data-JPA/" style="font-size: 10px;">Spring Data JPA</a> <a href="/tags/Spring-Modules/" style="font-size: 10px;">Spring Modules</a> <a href="/tags/Telnet/" style="font-size: 10px;">Telnet</a> <a href="/tags/Tuning/" style="font-size: 10px;">Tuning</a> <a href="/tags/USB/" style="font-size: 10px;">USB</a> <a href="/tags/Ubuntu/" style="font-size: 11.67px;">Ubuntu</a> <a href="/tags/Vim/" style="font-size: 10px;">Vim</a> <a href="/tags/Volumes/" style="font-size: 10px;">Volumes</a> <a href="/tags/Zabbix/" style="font-size: 11.67px;">Zabbix</a> <a href="/tags/Zookeeper/" style="font-size: 10px;">Zookeeper</a> <a href="/tags/apk/" style="font-size: 10px;">apk</a> <a href="/tags/emoji/" style="font-size: 10px;">emoji</a> <a href="/tags/enca/" style="font-size: 10px;">enca</a> <a href="/tags/mysqldump/" style="font-size: 11.67px;">mysqldump</a> <a href="/tags/swap/" style="font-size: 10px;">swap</a> <a href="/tags/utf8mb4/" style="font-size: 11.67px;">utf8mb4</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">ä¸­é—´ä»¶</a> <a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 10px;">ä¸»ä»å¤åˆ¶</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 10px;">åˆ†å¸ƒå¼é”</a> <a href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" style="font-size: 10px;">åˆ†åº“åˆ†è¡¨</a> <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">å•å…ƒæµ‹è¯•</a> <a href="/tags/%E5%AE%89%E5%8D%93/" style="font-size: 13.33px;">å®‰å“</a> <a href="/tags/%E5%BA%8F%E5%8F%B7%E7%94%9F%E6%88%90%E5%99%A8/" style="font-size: 10px;">åºå·ç”Ÿæˆå™¨</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size: 10px;">å¾®ä¿¡</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 11.67px;">å¾®æœåŠ¡</a> <a href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" style="font-size: 10px;">ç”µå­ä¹¦</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 15px;">ç›‘æ§</a> <a href="/tags/%E7%AD%BE%E5%90%8D/" style="font-size: 10px;">ç­¾å</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size: 11.67px;">ç¼–ç </a> <a href="/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" style="font-size: 10px;">è¯»å†™åˆ†ç¦»</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 18.33px;">è½¬è½½</a> <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" style="font-size: 10px;">é˜¿é‡Œäº‘</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/21/2016-08-24-import-data-into-mycat/">å°†ç°æœ‰æ•°æ®åº“çš„æ•°æ®å¯¼å…¥MyCAT</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-06-15-login-smtp-with-telnet/">åˆ©ç”¨telnetè¿›è¡ŒSMTPçš„éªŒè¯</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-06-27-monitor-mysql-with-zabbix/">ä½¿ç”¨Zabbixç›‘æ§MySQLæœåŠ¡å™¨</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-07-19-mongo-queries/">Mongoå¸¸ç”¨å‘½ä»¤</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-07-19-vim-commands/">Vimå¸¸ç”¨å‘½ä»¤</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>