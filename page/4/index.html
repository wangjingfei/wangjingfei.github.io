<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2016-09-09-apache-mesos-getstarted" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-09-09-apache-mesos-getstarted/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-09-09-apache-mesos-getstarted/">开始使用Mesos和Marathon</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Marathon 是可以跟 Mesos 一起协作的一个 framework，用来运行持久性的应用。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>一共需要安装四种组件，mesos-master、marathon、zookeeper 需要安装到所有的主节点，mesos-slave 需要安装到从节点。mesos 利用 zookeeper 来进行主节点的同步，以及从节点发现主节点的过程。</p>
<h3 id="获取Docker镜像"><a href="#获取Docker镜像" class="headerlink" title="获取Docker镜像"></a>获取Docker镜像</h3><p>在主节点上拉取mesos-master、marathon、zookeeper相关镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull mesoscloud/zookeeper</span><br><span class="line">docker pull mesoscloud/mesos-master</span><br><span class="line">docker pull fify/marathon</span><br></pre></td></tr></table></figure>
<p>在从节点上拉取mesos-slave镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mesoscloud/mesos-slave</span><br></pre></td></tr></table></figure>

<h3 id="启动主节点相关服务"><a href="#启动主节点相关服务" class="headerlink" title="启动主节点相关服务"></a>启动主节点相关服务</h3><p><strong>启动zookeeper</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e MYID=1 -e SERVERS=192.168.1.2 --name=zookeeper --net=host --restart=always mesoscloud/zookeeper</span><br></pre></td></tr></table></figure>
<p>如果有多个节点，则<code>SERVERS</code>参数为多个IP，用“,”隔开。</p>
<p><strong>启动mesos-master</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e MESOS_HOSTNAME=192.168.1.2 -e MESOS_IP=192.168.1.2 -e MESOS_QUORUM=1 -e MESOS_ZK=zk://192.168.1.2:2181/mesos --name mesos-master --net host --restart always mesoscloud/mesos-master</span><br></pre></td></tr></table></figure>

<p><strong>启动marathon</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e MARATHON_HOSTNAME=192.168.1.2 -e MARATHON_MASTER=zk://192.168.1.2:2181/mesos -e MARATHON_ZK=zk://192.168.1.2:2181/marathon --name marathon -p 8097:8080 --restart always fify/marathon</span><br></pre></td></tr></table></figure>

<h3 id="启动从节点相关服务"><a href="#启动从节点相关服务" class="headerlink" title="启动从节点相关服务"></a>启动从节点相关服务</h3><p>分别启动三个从节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e MESOS_HOSTNAME=192.168.1.2 -e MESOS_IP=192.168.1.2 -e MESOS_MASTER=zk://192.168.1.2:2181/mesos -v /sys/fs/cgroup:/sys/fs/cgroup -v /var/run/docker.sock:/var/run/docker.sock --name mesos-slave --net host --privileged --restart always mesoscloud/mesos-slave</span><br><span class="line">docker run -d -e MESOS_HOSTNAME=192.168.1.3 -e MESOS_IP=192.168.1.3 -e MESOS_MASTER=zk://192.168.1.2:2181/mesos -v /sys/fs/cgroup:/sys/fs/cgroup -v /var/run/docker.sock:/var/run/docker.sock --name mesos-slave --net host --privileged --restart always mesoscloud/mesos-slave</span><br><span class="line">docker run -d -e MESOS_HOSTNAME=192.168.1.4 -e MESOS_IP=192.168.1.4 -e MESOS_MASTER=zk://192.168.1.2:2181/mesos -v /sys/fs/cgroup:/sys/fs/cgroup -v /var/run/docker.sock:/var/run/docker.sock --name mesos-slave --net host --privileged --restart always mesoscloud/mesos-slave</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-09-09-apache-mesos-getstarted/" data-id="cklf7tstl002iz8t4anq6ebn7" data-title="开始使用Mesos和Marathon" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Marathon/" rel="tag">Marathon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mesos/" rel="tag">Mesos</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-09-09-zookeeper-senarios" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-09-09-zookeeper-senarios/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">分布式系统</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-09-09-zookeeper-senarios/">ZooKeeper典型使用场景总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>转载自：<a target="_blank" rel="noopener" href="http://blog.csdn.net/derekjiang/article/details/8751100">http://blog.csdn.net/derekjiang/article/details/8751100</a></p>
</blockquote>
<p>ZooKeeper是一个高可用的分布式数据管理与系统协调框架。基于对Paxos算法的实现，使该框架保证了分布式环境中数据的强一致性，也正是基于这样的特性，使得zookeeper能够应用于很多场景。网上对zk的使用场景也有不少介绍，本文将结合作者身边的项目例子，系统的对zk的使用场景进行归类介绍。 值得注意的是，zk并不是生来就为这些场景设计，都是后来众多开发者根据框架的特性，摸索出来的典型使用方法。因此，也非常欢迎你分享你在ZK使用上的奇技淫巧。</p>
<h2 id="数据发布与订阅"><a href="#数据发布与订阅" class="headerlink" title="数据发布与订阅"></a>数据发布与订阅</h2><p>发布与订阅即所谓的配置管理，顾名思义就是将数据发布到zk节点上，供订阅者动态获取数据，实现配置信息的集中式管理和动态更新。例如全局的配置信息，地址列表等就非常适合使用。</p>
<ol>
<li><strong>索引信息和集群中机器节点状态存</strong>放在zk的一些指定节点，供各个客户端订阅使用。</li>
<li><strong>系统日志（经过处理后的）存储</strong>，这些日志通常2-3天后被清除。</li>
<li><strong>应用中用到的一些配置信息</strong>集中管理，在应用启动的时候主动来获取一次，并且在节点上注册一个Watcher，以后每次配置有更新，实时通知到应用，获取最新配置信息。</li>
<li><strong>业务逻辑中需要用到的一些全局变量</strong>，比如一些消息中间件的消息队列通常有个offset，这个offset存放在zk上，这样集群中每个发送者都能知道当前的发送进度。</li>
<li><strong>系统中有些信息需要动态获取</strong>，并且还会存在人工手动去修改这个信息。以前通常是暴露出接口，例如JMX接口，有了zk后，只要将这些信息存放到zk节点上即可。</li>
</ol>
<h2 id="Name-Service"><a href="#Name-Service" class="headerlink" title="Name Service"></a>Name Service</h2><p>这个主要是作为分布式命名服务，通过调用zk的create node api，能够很容易创建一个全局唯一的path，这个path就可以作为一个名称。</p>
<h2 id="分布通知-协调"><a href="#分布通知-协调" class="headerlink" title="分布通知/协调"></a>分布通知/协调</h2><p>ZooKeeper中特有watcher注册与异步通知机制，能够很好的实现分布式环境下不同系统之间的通知与协调，实现对数据变更的实时处理。使用方法通常是不同系统都对ZK上同一个znode进行注册，监听znode的变化（包括znode本身内容及子节点的），其中一个系统update了znode，那么另一个系统能够收到通知，并作出相应处理。</p>
<ol>
<li><strong>另一种心跳检测机制</strong>：检测系统和被检测系统之间并不直接关联起来，而是通过zk上某个节点关联，大大减少系统耦合。</li>
<li><strong>另一种系统调度模式</strong>：某系统有控制台和推送系统两部分组成，控制台的职责是控制推送系统进行相应的推送工作。管理人员在控制台作的一些操作，实际上是修改了ZK上某些节点的状态，而zk就把这些变化通知给他们注册Watcher的客户端，即推送系统，于是，作出相应的推送任务。</li>
<li><strong>另一种工作汇报模式</strong>：一些类似于任务分发系统，子任务启动后，到zk来注册一个临时节点，并且定时将自己的进度进行汇报（将进度写回这个临时节点），这样任务管理者就能够实时知道任务进度。</li>
</ol>
<p>总之，使用zookeeper来进行分布式通知和协调能够大大降低系统之间的耦合。</p>
<h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><p>分布式锁，这个主要得益于ZooKeeper为我们保证了数据的强一致性，即用户只要完全相信每时每刻，zk集群中任意节点（一个zk server）上的相同znode的数据是一定是相同的。<strong>锁服务可以分为两类，一个是保持独占，另一个是控制时序</strong>。</p>
<p>所谓保持独占，就是所有试图来获取这个锁的客户端，最终只有一个可以成功获得这把锁。通常的做法是把zk上的一个znode看作是一把锁，通过create znode的方式来实现。所有客户端都去创建 /distribute_lock 节点，最终成功创建的那个客户端也即拥有了这把锁。</p>
<p>控制时序，就是所有视图来获取这个锁的客户端，最终都是会被安排执行，只是有个全局时序了。做法和上面基本类似，只是这里 /distribute_lock 已经预先存在，客户端在它下面创建临时有序节点（这个可以通过节点的属性控制：CreateMode.EPHEMERAL_SEQUENTIAL来指定）。Zk的父节点（/distribute_lock）维持一份sequence,保证子节点创建的时序性，从而也形成了每个客户端的全局时序。</p>
<h2 id="集群管理"><a href="#集群管理" class="headerlink" title="集群管理"></a>集群管理</h2><h3 id="集群机器监控"><a href="#集群机器监控" class="headerlink" title="集群机器监控"></a>集群机器监控</h3><p>这通常<strong>用于那种对集群中机器状态，机器在线率有较高要求的场景</strong>，能够快速对集群中机器变化作出响应。这样的场景中，往往有一个监控系统，实时检测集群机器是否存活。过去的做法通常是：监控系统通过某种手段（比如ping）定时检测每个机器，或者每个机器自己定时向监控系统汇报“我还活着”。 这种做法可行，但是存在两个比较明显的问题：1. 集群中机器有变动的时候，牵连修改的东西比较多。2. 有一定的延时。</p>
<p>利用ZooKeeper有两个特性，就可以实时另一种集群机器存活性监控系统：a. 客户端在节点 x 上注册一个Watcher，那么如果 x 的子节点变化了，会通知该客户端。b. 创建EPHEMERAL类型的节点，一旦客户端和服务器的会话结束或过期，那么该节点就会消失。</p>
<p>例如，监控系统在 /clusterServers 节点上注册一个Watcher，以后每动态加机器，那么就往 /clusterServers 下创建一个 EPHEMERAL类型的节点：/clusterServers/{hostname}. 这样，监控系统就能够实时知道机器的增减情况，至于后续处理就是监控系统的业务了。</p>
<blockquote>
<p>在搜索系统中，如果集群中每个机器都生成一份全量索引，不仅耗时，而且不能保证彼此之间索引数据一致。因此让集群中的Master来进行全量索引的生成，然后同步到集群中其它机器。</p>
</blockquote>
<h3 id="Master选举"><a href="#Master选举" class="headerlink" title="Master选举"></a>Master选举</h3><p>在分布式环境中，相同的业务应用分布在不同的机器上，有些业务逻辑（例如一些耗时的计算，网络I/O处理），往往只需要让整个集群中的某一台机器进行执行，其余机器可以共享这个结果，这样可以大大减少重复劳动，提高性能，于是这个master选举便是这种场景下的碰到的主要问题。</p>
<p>利用ZooKeeper的强一致性，能够保证在分布式高并发情况下节点创建的全局唯一性，即：同时有多个客户端请求创建 /currentMaster 节点，最终一定只有一个客户端请求能够创建成功。</p>
<p>利用这个特性，就能很轻易的在分布式环境中进行集群选取了。</p>
<p>另外，这种场景演化一下，就是动态Master选举。这就要用到 EPHEMERAL_SEQUENTIAL类型节点的特性了。</p>
<p>上文中提到，所有客户端创建请求，最终只有一个能够创建成功。在这里稍微变化下，就是允许所有请求都能够创建成功，但是得有个创建顺序，于是所有的请求最终在ZK上创建结果的一种可能情况是这样： /currentMaster/{sessionId}-1 , /currentMaster/{sessionId}-2 , /currentMaster/{sessionId}-3 ….. 每次选取序列号最小的那个机器作为Master，如果这个机器挂了，由于他创建的节点会马上小时，那么之后最小的那个机器就是Master了。</p>
<blockquote>
<p>Master选举的容灾措施是，可以随时进行手动指定master，就是说应用在zk在无法获取master信息时，可以通过比如http方式，向一个地方获取master。</p>
</blockquote>
<h2 id="分布式队列"><a href="#分布式队列" class="headerlink" title="分布式队列"></a>分布式队列</h2><p>队列方面，我目前感觉有两种，<strong>一种是常规的先进先出队列，另一种是要等到队列成员聚齐之后的才统一按序执行</strong>。对于第一种先进先出队列，和分布式锁服务中的控制时序场景基本原理一致，这里不再赘述。</p>
<p>第二种队列其实是在FIFO队列的基础上作了一个增强。通常可以在 /queue 这个znode下预先建立一个/queue/num 节点，并且赋值为n（或者直接给/queue赋值n），表示队列大小，之后每次有队列成员加入后，就判断下是否已经到达队列大小，决定是否可以开始执行了。这种用法的典型场景是，分布式环境中，一个大任务Task A，需要在很多子任务完成（或条件就绪）情况下才能进行。这个时候，凡是其中一个子任务完成（就绪），那么就去 /taskList 下建立自己的临时时序节点（CreateMode.EPHEMERAL_SEQUENTIAL），当 /taskList 发现自己下面的子节点满足指定个数，就可以进行下一步按序进行处理了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-09-09-zookeeper-senarios/" data-id="cklf7tsto002lz8t40zf31658" data-title="ZooKeeper典型使用场景总结" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Zookeeper/" rel="tag">Zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-09-20-install-apk-on-ubuntu" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-09-20-install-apk-on-ubuntu/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-09-20-install-apk-on-ubuntu/">Ubuntu上使用USB安装APK到手机</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Ubuntu上可以使用<code>adb</code>命令安装APK到手机上。</p>
<h2 id="安装adb"><a href="#安装adb" class="headerlink" title="安装adb"></a>安装adb</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install android-tools-adb</span><br></pre></td></tr></table></figure>

<h2 id="查看已经连接的设备"><a href="#查看已经连接的设备" class="headerlink" title="查看已经连接的设备"></a>查看已经连接的设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb devices</span><br></pre></td></tr></table></figure>
<p>输出如下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-Vostro-3902:~$ adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">ZLPFCI6L4LEUJJUG        device</span><br></pre></td></tr></table></figure>

<h2 id="安装APK包到指定设备"><a href="#安装APK包到指定设备" class="headerlink" title="安装APK包到指定设备"></a>安装APK包到指定设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb -s ZLPFCI6L4LEUJJUG install ~/Desktop/Irenshi_V3.3.1-27_release.apk</span><br></pre></td></tr></table></figure>
<p>其中<code>-s</code>指定要安装到哪一台设备。</p>
<p>输出如下，当出现<strong>Success</strong>的时候表示安装成功，这时可以在手机上运行已经安装的程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-Vostro-3902:~$ adb -s ZLPFCI6L4LEUJJUG install ~&#x2F;Desktop&#x2F;Irenshi_V3.3.1-27_release.apk</span><br><span class="line">12243 KB&#x2F;s (27987100 bytes in 2.232s)</span><br><span class="line">        pkg: &#x2F;data&#x2F;local&#x2F;tmp&#x2F;Irenshi_V3.3.1-27_release.apk</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-09-20-install-apk-on-ubuntu/" data-id="cklf7tstp002nz8t40ctpavf1" data-title="Ubuntu上使用USB安装APK到手机" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/USB/" rel="tag">USB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">安卓</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-09-21-sign-apk-with-jarsigner" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-09-21-sign-apk-with-jarsigner/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-09-21-sign-apk-with-jarsigner/">Android包（apk）手动签名</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jarsigner -verbose -keystore &lt;keystore file&gt; -signedjar &lt;output signed file&gt; &lt;apk to be signed&gt; &lt;<span class="built_in">alias</span>&gt;</span><br></pre></td></tr></table></figure>

<p>举例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jarsigner -verbose -keystore IrenshiRelease.keystore -signedjar signed.apk unsign.apk i人事</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-09-21-sign-apk-with-jarsigner/" data-id="cklf7tstr002qz8t461dsa1ee" data-title="Android包（apk）手动签名" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apk/" rel="tag">apk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">安卓</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AD%BE%E5%90%8D/" rel="tag">签名</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-09-22-convert-file-charsets-batch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-09-22-convert-file-charsets-batch/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-09-22-convert-file-charsets-batch/">批量转换文件编码</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Linux上可以使用<code>enca</code>查看和转换文件编码。</p>
<h2 id="查看文件编码"><a href="#查看文件编码" class="headerlink" title="查看文件编码"></a>查看文件编码</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enca [-L LANGUAGE] [FILE]...</span><br></pre></td></tr></table></figure>

<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>以下命令可以查看一个中文文档采用了什么编码格式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enca -L zh_CN file.txt</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fify@fify-Vostro-3902:~$ enca -L zh_CN password.txt</span><br><span class="line">Universal transformation format 8 bits; UTF-8</span><br></pre></td></tr></table></figure>

<h3 id="特别注意"><a href="#特别注意" class="headerlink" title="特别注意"></a>特别注意</h3><p>这个命令并不能100%正确的检测到文件编码，当文件中的汉字较少的时候就可能无法判断文件编码格式。（由此可见，<code>enca</code>命令也是根据文件中出现的特殊文字的编码范围“猜测”文件编码格式的。）</p>
<p>无法判断编码时输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;src&#x2F;main&#x2F;res&#x2F;layout&#x2F;activity_base_time_range_layout.xml: Unrecognized encoding</span><br></pre></td></tr></table></figure>

<h2 id="批量转换文件编码"><a href="#批量转换文件编码" class="headerlink" title="批量转换文件编码"></a>批量转换文件编码</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enca [-L LANGUAGE] -x &lt;charset&gt; [FILE]</span><br></pre></td></tr></table></figure>

<h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><p>单个转换一个文件的编码时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enca -L zh_CN -x UTF-8 file.txt</span><br></pre></td></tr></table></figure>
<p>批量转换某个目录下所有<code>.java</code>文件的编码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -name *.java | xargs enca -L zh_CN -x UTF-8</span><br></pre></td></tr></table></figure>
<p><code>enca</code>还有一个好处就是如果文件本来就是你要转换的那种编码，它不会报错，还是会print出结果来。</p>
<h3 id="特别注意-1"><a href="#特别注意-1" class="headerlink" title="特别注意"></a>特别注意</h3><p>虽然<code>enca</code>会跳过已经是目标编码的文件，但是多次转换同一个文件还是有出错的风险，转换完成之后记得检查。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-09-22-convert-file-charsets-batch/" data-id="cklf7tsts002uz8t4c4kn3qfu" data-title="批量转换文件编码" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/enca/" rel="tag">enca</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E7%A0%81/" rel="tag">编码</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-10-10-ebook-search-conversion" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-10-10-ebook-search-conversion/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-10-10-ebook-search-conversion/">好用的电子书搜索和格式转换平台</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>小蜜蜂在线电子书转换器，免费电子书格式转换，转换的格式支持各种阅读软件与设备。质量无损，转换速度快，简单易用。</p>
<p>传送门：<a target="_blank" rel="noopener" href="http://cn.epubee.com/">http://cn.epubee.com/</a></p>
<h2 id="电子书格式转换"><a href="#电子书格式转换" class="headerlink" title="电子书格式转换"></a>电子书格式转换</h2><p>它支持 ePub，PDF，Mobi，AZW，AZW3，AZW4，htmlz，PRC，TXT，LIT，LRF，FB2，PDB，TXT等电子书格式的转换。</p>
<p>支持三种输出格式： EPUB，PDF，Mobi。</p>
<p>无损，免费，简单且功能强大，在线电子书转换器致力于为读者提供最好的电子书相关解决方案。充分利用这一工具，并将电子书转换成您最喜爱的格式，在任何便利的电子阅读器上都能得到最佳阅读体验。</p>
<p><strong>优势:</strong></p>
<ul>
<li>支持单个文件大小高达60MB</li>
<li>支持批量上传和处理</li>
<li>页面上没有烦人的广告，清晰安全</li>
<li>独具优势的文件转换核心，更快更好</li>
</ul>
<h2 id="图书搜索"><a href="#图书搜索" class="headerlink" title="图书搜索"></a>图书搜索</h2><p>简单不用说，输入名字、ASIN或ISBN就可以搜索了。</p>
<h2 id="传送门"><a href="#传送门" class="headerlink" title="传送门"></a>传送门</h2><p><a target="_blank" rel="noopener" href="http://cn.epubee.com/">http://cn.epubee.com/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-10-10-ebook-search-conversion/" data-id="cklf7tstt002yz8t4b6qi3oh2" data-title="好用的电子书搜索和格式转换平台" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" rel="tag">电子书</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-10-10-set-vim-encoding" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-10-10-set-vim-encoding/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-10-10-set-vim-encoding/">设置VIM的编码格式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>有的时候使用vim打开中文文件的时候会出现乱码，原因是vim打开文件时使用的编码格式和文件的编码格式不一致。</p>
<h2 id="设置正确的编码格式以正确的显示中文"><a href="#设置正确的编码格式以正确的显示中文" class="headerlink" title="设置正确的编码格式以正确的显示中文"></a>设置正确的编码格式以正确的显示中文</h2><p>如果该文档使用utf8编码，则可以通过以下vim命令将编码格式设置为utf8：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> encoding=utf-<span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>这样本来以乱码显示的中文就可以恢复本来面貌。</p>
<h2 id="设置VIM保存文件时的编码格式"><a href="#设置VIM保存文件时的编码格式" class="headerlink" title="设置VIM保存文件时的编码格式"></a>设置VIM保存文件时的编码格式</h2><p>为保证VIM编辑器保存的文件以utf8编码格式存储，可以先执行以下命令，然后再进行保存：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> fileencodings=utf-<span class="number">8</span></span><br><span class="line"><span class="keyword">w</span></span><br></pre></td></tr></table></figure>

<h2 id="设置VIM默认编码格式"><a href="#设置VIM默认编码格式" class="headerlink" title="设置VIM默认编码格式"></a>设置VIM默认编码格式</h2><p>将以上两个命令加入到<code>~/.vimrc</code>文件中，则可以是VIM默认以utf8编码打开文件，并且以utf8编码存储文件：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+set encoding=utf-8</span></span><br><span class="line"><span class="addition">+set fileencodings=utf-8</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-10-10-set-vim-encoding/" data-id="cklf7tstv0031z8t45vpl0cbr" data-title="设置VIM的编码格式" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E7%A0%81/" rel="tag">编码</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-10-14-introduction-to-android-service" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-10-14-introduction-to-android-service/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-10-14-introduction-to-android-service/">关于 Android Service 的介绍</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>转载自：<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/63792fc84d94#">http://www.jianshu.com/p/63792fc84d94#</a></p>
</blockquote>
<p>Service 是 Android 的四大组件之一，它主要的作用是后台执行操作，Activity 属于带有 UI 界面跟用户进行交互，而 Service 则没有 UI 界面，所有的操作都是基于后台运行完成。并且 Service 跟 Activity 一样也是可以由其它的应用程序调用启动的，而且就算用户切换了应用程序，Service 依旧保持运行。一个组件如果与 Service 进行了绑定( bind ),就可以跟 Service 进行数据的交互，并且也可以跟不同的进程之间进行交互 (IPC)。通常会使用到 Service 的情况有进行网络请求，音乐的操控，文件的 I/O 操作等。</p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>Service 通常是通过以下两种方式进行启动</p>
<h3 id="startService"><a href="#startService" class="headerlink" title="startService"></a>startService</h3><p>当组件(例如 activity)通过调用<code>startService()</code>来启动 Service 的时候。一旦启动后，Service 就会独立的在后台运行，即使调用的组件已经销毁了，Service 还是可以继续在后台运行。一般情况下，<strong>只需要进行一次单独的操作，不需要将操作后的结果返回给调用者的时候，会使用该方式启动 Service</strong>。例如，进行上传或者下载操作的时候，当操作完成后，Service 应该自行调用 <code>stopService()</code> 或 <code>stopSelf()</code> 来结束运行。</p>
<h3 id="bindService"><a href="#bindService" class="headerlink" title="bindService"></a>bindService</h3><p>当组件(例如 activity)通过调用 <code>bindService()</code> 来启动 Service 的时候。这种方式提供了 client - service 的接口，可以让调用组件跟 Service 进行发送请求及返回结果的操作，设置可以进行进程间的通信 (IPC)。只要有一个组件对该 Service 进行了绑定，那该 Service 就不会销毁。并且多个组件可以同时对一个 Service 进行绑定，只有在所有进行了绑定的组件都解绑的时候，Service 才会销毁。</p>
<p>尽管两种方式是分开讨论的，但是并不是互斥的关系，使用 startService 启动了 Service 后，也是可以进行绑定的。</p>
<blockquote>
<p><strong>注意：</strong>虽然 Service 是在后台运行，但是其实还是在主线程里进行所有的操作的。Service 在启动时除非单独进行了定义，否则不会运行在单独的线程或者进程里，而都是在主线程里。所以这表示任何能堵塞主线程的操作（例如音乐的播放或者网络请求）都应该单独开辟新的线程来进行操作，否则很容易出现 ANR 。</p>
</blockquote>
<hr>
<blockquote>
<p>如果某个组件是通过调用 startService() 的方式来启动了 Service，那这个 Service 就会一直在后台运行直到 Service 内部调用 stopSelf() 或某个组件调用 stopService() 来结束该 Service。</p>
</blockquote>
<blockquote>
<p>如果某个组件是通过调用 bindService() 的方式来启动了 Service，那这个 Service 就会一直在后台运行直到该组件与其解绑。Service 在没有任何组件绑定的时候，系统会将其销毁</p>
</blockquote>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>在创建一个 Service 时，必须要去继承 Service，并且要重写父类一些主要的方法来实现功能。以下是主要方法的介绍</p>
<h3 id="onStartCommand"><a href="#onStartCommand" class="headerlink" title="onStartCommand()"></a>onStartCommand()</h3><p>系统会调用这个函数当某个组件(例如 activity，fragment)通过调用 <code>startService()</code> 启动 Service 时。在该方法被调用后，Service 就会被启动并独立的在后台运行。如果重写了该方法，开发者需要在 Service 执行完操作后自行的调用 <code>stopSelf()</code> 或 <code>stopService()</code>来结束 Service。如果只是会通过绑定的方式 (bind) 的方式来启动 Service 则不需要重写该方法。</p>
<h3 id="onBind"><a href="#onBind" class="headerlink" title="onBind()"></a>onBind()</h3><p>当某个组件(例如 activity, fragment)通过调用 <code>bindService()</code>绑定的方式来启动 Service 的时候，系统会调用这个函数。在实现这个函数的时候，必须要返回一个 IBinder 的继承类，来与 Service 进行通信。这个函数是默认必须要重写的，但是如果不想通过绑定的方式来启动 Service，则可以直接返回 null</p>
<h3 id="onCreate"><a href="#onCreate" class="headerlink" title="onCreate()"></a>onCreate()</h3><p>系统会调用此方法在第一次启动 Service 的时候，用于初始化一些一次性的变量。<strong>如果 Service 已经启动了，则此方法就不会再别调用。</strong></p>
<h3 id="onDestroy"><a href="#onDestroy" class="headerlink" title="onDestroy()"></a>onDestroy()</h3><p>系统在 Service 即将被销毁的时候会调用此方法。Service 中如有用到 thread、listeners、receivers 等的时候，应该将这些的清理方法写在此方法内。</p>
<p>如果某个组件是通过调用 startService() 的方式来启动了 Service，那这个 Service 就会一直在后台运行直到 Service 内部调用 stopSelf() 或某个组件调用 stopService() 来结束该 Service。</p>
<p>如果某个组件是通过调用 bindService() 的方式来启动了 Service，那这个 Service 就会一直在后台运行直到该组件与其解绑。Service 在没有任何组件绑定的时候，系统会将其销毁</p>
<h2 id="使用Service"><a href="#使用Service" class="headerlink" title="使用Service"></a>使用Service</h2><p>下面的环节，将介绍如果通过上面讲述的两种方式来创建 Service</p>
<h3 id="在-Manifest-里声明-Service"><a href="#在-Manifest-里声明-Service" class="headerlink" title="在 Manifest 里声明 Service"></a>在 Manifest 里声明 Service</h3><p>类似于 Activity，所有的 Service 都要在 Manifest 里面进行声明，如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">application</span> <span class="attr">...</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">&quot;.ExampleService&quot;</span> /&gt;</span></span><br><span class="line">      ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查看 <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/service-element.html">&lt;service&gt;</a> 标签的官方文档来获取更多信息</p>
<p>通过在 &lt;service&gt; 标签里将 <code>android:exported</code> 设置为 false。可以防止其他的程序来启动你的 Service。</p>
<h3 id="通过-started-方式来启动-Service"><a href="#通过-started-方式来启动-Service" class="headerlink" title="通过 started 方式来启动 Service"></a>通过 started 方式来启动 Service</h3><p>组件(例如 activity, fragment) 通过调用 <code>startService()</code> 方法，系统随之调用 <code>onStartCommand()</code> 方法来实现 started 方式启动 Service。</p>
<p>当 Service 以该形式启动后，Service 的整个生命周期是完全独立的，即便启动 Service 的组件已经被销毁了，Service 还是可以在后台无限的运行的。但开发者应该在 Service 中的操作执行完成后，调用 <code>stopSelf()</code> 或其它组件调用 <code>stopService()</code> 的方式来结束该 Service。</p>
<p>程序组件(例如 activity) 可以通过传递一个 Intent 给 <code>startService()</code>,来实现组件与 Service 之前的数据传递。Service 是通过系统调用的 <code>onStartCommand()</code> 方法接受传递的Intent ，完成整个数据传递过程。</p>
<blockquote>
<p><strong>注意:</strong> Service 本身默认是运行在主线程里的，所以如果在 Service 要进行一些会堵塞线程的操作，一定要将这些操作放在一个新的线程里。</p>
</blockquote>
<p>Android 的框架提供了 <a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/app/IntentService.html">IntentService</a> 来满足后台运行异步线程的需求。</p>
<h4 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h4><p>IntentService 是 Service 的子类，并且所有的请求操作都是在异步线程里。<strong>如果不需要 Service 来同时处理多个请求的话，IntentService 将会是最佳的选择。</strong>只需要继承并重写 IntentService 中的 <code>onHandleIntent()</code> 方法，就可以对接受到的 Intent 做后台的异步线程操作了。</p>
<p>IntentService 提供了如下的几个功能:</p>
<ul>
<li>会创建一个异步线程来处理所有从程序主线程发送到 <code>onStartCommand()</code> 的 intents 。</li>
<li>创建了一个队列池来保证每次只有一个 Intent 传递到 <code>onHandleIntent()</code> 方法中，避免了多线程问题。</li>
<li>提供默认 <code>onBind()</code> 方法的实现，返回 null</li>
<li>提供默认 <code>onStartCommand()</code> 方法的实现，将收到的 intent 放到队列池中，然后再交由 <code>onHandleIntent()</code> 做处理</li>
</ul>
<p>所有开发者只需要实现 <code>onHandleIntent()</code> 关注于 Service 要进行的操作即可。关于更多的 IntentService 实用技巧，请查看此文章：<a target="_blank" rel="noopener" href="https://github.com/codepath/android_guides/wiki/Starting-Background-Services%E3%80%82">https://github.com/codepath/android_guides/wiki/Starting-Background-Services。</a></p>
<p>如果开发者需要重写其他的一些方法，例如 <code>onCreate()</code>, <code>onStartCommand()</code>, 和 <code>onDestroy()</code>，请保证调用父类的实现，这样可以保证 IntentService 能够正确的来处理线程的生命周期。例如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;service starting&quot;</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent,flags,startId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="系统回收资源问题"><a href="#系统回收资源问题" class="headerlink" title="系统回收资源问题"></a>系统回收资源问题</h4><p>当系统内存不足的时候，系统会强制回收一些 Activity 和 Service 来获取更多的资源给那些用户正在交互的程序或页面。这就要求当资源充足的时候 Service 能够自动重启。这个功能是通过 <code>onStartCommand()</code> 的返回值来实现的</p>
<h5 id="START-NOT-STICKY"><a href="#START-NOT-STICKY" class="headerlink" title="START_NOT_STICKY"></a>START_NOT_STICKY</h5><p>当系统因回收资源而销毁了 Service，当资源再次充足时不自动启动 Service。除非还有未处理的 Intent 准备发送。当你的程序可以很容易的重新开启未完成的操作时，这是最安全的避免 Service 在不必要的情况下启动的选项。</p>
<h5 id="START-STICKY"><a href="#START-STICKY" class="headerlink" title="START_STICKY"></a>START_STICKY</h5><p>当系统因回收资源而销毁了 Service，当资源再次充足时自动启动 Service，并且再次调用 <code>onStartCommand()</code> 方法，但是不会传递最后一次的 Intent，相反系统在回调<code>onStartCommand()</code> 的时候会传一个空 Intent 。除非还有未处理的 Intent 准备发送。</p>
<h5 id="START-REDELIVER-INTENT"><a href="#START-REDELIVER-INTENT" class="headerlink" title="START_REDELIVER_INTENT"></a>START_REDELIVER_INTENT</h5><p>当系统因回收资源而销毁了 Service，当资源再次充足时自动启动 Service，并且再次调用 <code>onStartCommand()</code> 方法，并会把最后一次 Intent 再次传递给<code>onStartCommand()</code>，相应的在队列里的 Intent 也会按次序依次传递。此模式适用于下载等服务。</p>
<h4 id="Start-Service"><a href="#Start-Service" class="headerlink" title="Start Service"></a>Start Service</h4><p>该方式允许多个组件同时对相同的 Service 进行 startService 操作，但是如果只要有其中有一个组件调用了 <code>stopSelf()</code> 或 <code>stopService()</code>, 该 Service 就会被销毁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, HelloService.class);</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure>

<h4 id="Stop-Service"><a href="#Stop-Service" class="headerlink" title="Stop Service"></a>Stop Service</h4><p>当有多个组件进行了 startService 操作时，不应该直接的去调用 <code>stopSelf()</code> 或 <code>stopService()</code> 来结束 Service， 因为这会对其他已经发起请求的操作产生影响，故在 <code>onStartCommand()</code> 方法中会接受一个 startId, 然后在结束 Service 时，调用 <code>stopService(int)</code> 方法来只是结束一个特定的请求，从而达到保护其他请求不受影响的目的。</p>
<h3 id="通过-Bind-方式启动-Service"><a href="#通过-Bind-方式启动-Service" class="headerlink" title="通过 Bind 方式启动 Service"></a>通过 Bind 方式启动 Service</h3><p>当应用程序中的 activity 或其它组件需要与服务进行交互，或者应用程序的某些功能需要暴露给其它应用程序时，你应该创建一个 Bind 服务，并通过进程间通信（IPC）来完成。</p>
<p>Service 只在为绑定的应用程序组件工作时才会存活，因此，只要没有组件绑定到服务，系统就会自动销毁服务</p>
<h4 id="获取-IBinder-实例"><a href="#获取-IBinder-实例" class="headerlink" title="获取 IBinder 实例"></a>获取 IBinder 实例</h4><h5 id="扩展-Binder-类"><a href="#扩展-Binder-类" class="headerlink" title="扩展 Binder 类"></a>扩展 Binder 类</h5><p>如果服务是你的应用程序所私有的，并且与客户端运行于同一个进程中（通常都是如此），你应该通过扩展 Binder 类来创建你的接口，并从 <code>onBind()</code> 返回一个它的实例。客户端接收该 Binder 对象并用它来直接访问 Binder 甚至 Service中可用的公共方法。</p>
<p><strong>如果你的服务只是为你自己的应用程序执行一些后台工作，那这就是首选的技术方案。</strong>不用这种方式来创建接口的理由只有一个，就是服务要被其它应用程序使用或者要跨多个进程使用。</p>
<h5 id="使用-Messenger"><a href="#使用-Messenger" class="headerlink" title="使用 Messenger"></a>使用 Messenger</h5><p>如果你需要接口跨越多个进程进行工作，可以通过 Messenger 来为服务创建接口。在这种方式下，服务定义一个响应各类消息对象 Message 的 Handler。此 Handler 是 Messenger 与客户端共享同一个 IBinder 的基础，它使得客户端可以用消息对象 Message向服务发送指令。此外，客户端还可以定义自己的 Message ，以便服务能够往回发送消息。</p>
<p>这是执行进程间通信（IPC）最为简便的方式，因为 Messenger 会把所有的请求放入一个独立进程中的队列，这样你就不一定非要把服务设计为线程安全的模式了。</p>
<h5 id="使用-AIDL"><a href="#使用-AIDL" class="headerlink" title="使用 AIDL"></a>使用 AIDL</h5><p>绝大多数应用程序都<strong>不应该</strong>用 AIDL 来创建 bind 服务，因为这可能需要多线程处理能力并且会让代码变得更为复杂。 因此，AIDL 对绝大多数应用程序都不适用，并且本文也不会讨论如何在服务中使用它的内容。如果你确信需要直接使用 AIDL，那请参阅 <a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/aidl.html">AIDL 文档</a>。</p>
<h4 id="扩展-Binder-类-1"><a href="#扩展-Binder-类-1" class="headerlink" title="扩展 Binder 类"></a>扩展 Binder 类</h4><p>如果你的服务只用于本地应用程序并且不需要跨进程工作，那你只要实现自己的 Binder 类即可，这样你的客户端就能直接访问服务中的公共方法了。</p>
<blockquote>
<p>注意：仅当客户端和服务位于同一个应用程序和进程中，这也是最常见的情况，这种方式才会有用。比如，一个音乐应用需要把一个 activity 绑定到它自己的后台音乐播放服务上，采用这种方式就会很不错。</p>
</blockquote>
<p>以下是设置步骤:</p>
<ol>
<li>在你的服务中，创建一个 Binder 的实例，其中实现以下三者之一：<ul>
<li>包含了可供客户端调用的公共方法</li>
<li>返回当前 Service 实例，其中包含了可供客户端调用的公共方法</li>
<li>或者，返回内含 Service 类的其它类的一个实例，Service 中包含了可供客户端调用的公共方法</li>
</ul>
</li>
<li>从回调方法 <code>onBind()</code> 中返回 Binder 的该实例</li>
<li>在客户端中，在回调方法 <code>onServiceConnected()</code> 中接收 Binder 并用所提供的方法对绑定的服务进行调用</li>
</ol>
<blockquote>
<p><strong>注意：</strong>服务和客户端之所以必须位于同一个应用程序中，是为了让客户端能够正确转换（cast）返回的对象并调用对象的 API。 服务和客户端也必须位于同一个进程中，因为这种方式不能执行任何跨进程的序列化（marshalling）操作。</p>
</blockquote>
<p>具体的实用案例请查看在<a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/development/+/master/samples/ApiDemos/">ApiDemos</a> 中的 <a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/development/+/master/samples/ApiDemos/src/com/example/android/apis/app/LocalService.java">LocalService.java</a> 类和 <a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/development/+/master/samples/ApiDemos/src/com/example/android/apis/app/LocalServiceActivities.java">LocalServiceActivities.java</a>。</p>
<h2 id="Service-的生命周期"><a href="#Service-的生命周期" class="headerlink" title="Service 的生命周期"></a>Service 的生命周期</h2><p><img src="/upload/images/13.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-10-14-introduction-to-android-service/" data-id="cklf7tstw0034z8t4715f6i68" data-title="关于 Android Service 的介绍" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-Service/" rel="tag">Android Service</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">安卓</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2016-10-31-read-mysql-binlog-as-sql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2016-10-31-read-mysql-binlog-as-sql/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2016-10-31-read-mysql-binlog-as-sql/">以SQL方式读取MySQL的GTID格式Binlog</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>将GTID格式的binlog转换为SQL的命令：</p>
<blockquote>
<p><code>mysqlbinlog --no-defaults -v --base64-output=DECODE-ROWS  --skip-gtids mysql-bin.000714</code></p>
</blockquote>
<hr>
<p>下面讲详细介绍每个参数的意义，以及为什么需要添加这些参数。</p>
<h2 id="MySQL及mysqlbinlog的版本"><a href="#MySQL及mysqlbinlog的版本" class="headerlink" title="MySQL及mysqlbinlog的版本"></a>MySQL及mysqlbinlog的版本</h2><h2 id="mysqlbinlog"><a href="#mysqlbinlog" class="headerlink" title="mysqlbinlog"></a>mysqlbinlog</h2><p><code>mysqlbinlog</code>是MySQL官方提供的读取binlog的工具。其执行方法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog [options] log_file ...</span><br></pre></td></tr></table></figure>

<h3 id="no-defaults参数"><a href="#no-defaults参数" class="headerlink" title="--no-defaults参数"></a><code>--no-defaults</code>参数</h3><p>直接执行<code>mysqlbinlog</code>命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog mysql-bin.000858</span><br></pre></td></tr></table></figure>
<p>执行失败，报如下错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog: unknown variable &#39;default-character-set&#x3D;utf8mb4&#39;</span><br></pre></td></tr></table></figure>
<p>因为使用了默认编码，但是mysqlbinlog又无法正常解析。增加<code>--no-defaults</code>参数直接跳过默认编码格式。</p>
<p>手册中关于该参数的说明：</p>
<blockquote>
<p><strong>–no-defaults</strong></p>
</blockquote>
<blockquote>
<p>Do not read any option files. If program startup fails due to reading unknown options from an option file, –no-defaults can be used to prevent them from being read.</p>
</blockquote>
<blockquote>
<p>The exception is that the .mylogin.cnf file, if it exists, is read in all cases. This permits passwords to be specified in a safer way than on the command line even when –no-defaults is used. (.mylogin.cnf is created by the mysql_config_editor utility. See mysql_config_editor(1).)</p>
</blockquote>
<h3 id="v参数"><a href="#v参数" class="headerlink" title="-v参数"></a>-v参数</h3><p>增加<code>--no-defaults</code>参数，执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --no-defaults mysql-bin.000858</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE&#x3D;1*&#x2F;;</span><br><span class="line">&#x2F;*!40019 SET @@session.max_insert_delayed_threads&#x3D;0*&#x2F;;</span><br><span class="line">&#x2F;*!50003 SET @OLD_COMPLETION_TYPE&#x3D;@@COMPLETION_TYPE,COMPLETION_TYPE&#x3D;0*&#x2F;;</span><br><span class="line">DELIMITER &#x2F;*!*&#x2F;;</span><br><span class="line"># at 4</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 120 CRC32 0x095b60fa  Start: binlog v 4, server v 5.6.27-0ubuntu0.14.04.1-log created 161123  4:17:00</span><br><span class="line">BINLOG &#39;</span><br><span class="line">vKc0WA8BAAAAdAAAAHgAAAAAAAQANS42LjI3LTB1YnVudHUwLjE0LjA0LjEtbG9nAAAAAAAAAAAA</span><br><span class="line">AAAAAAAAAAAAAAAAAAAAAAAAEzgNAAgAEgAEBAQEEgAAXAAEGggAAAAICAgCAAAACgoKGRkAAfpg</span><br><span class="line">Wwk&#x3D;</span><br><span class="line">&#39;&#x2F;*!*&#x2F;;</span><br><span class="line"># at 120</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 231 CRC32 0xbbec3fba  Previous-GTIDs</span><br><span class="line"># 9dc1a422-aeb6-11e5-80cd-00163e001e5d:1-5846827,</span><br><span class="line"># fd076ada-69cf-11e6-84d8-00163e0c1dbe:1-381819</span><br><span class="line"># at 231</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 279 CRC32 0x3f0812c4  GTID [commit&#x3D;yes]</span><br><span class="line">SET @@SESSION.GTID_NEXT&#x3D; &#39;9dc1a422-aeb6-11e5-80cd-00163e001e5d:5846828&#39;&#x2F;*!*&#x2F;;</span><br><span class="line"># at 279</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 353 CRC32 0x6982c05a  Query   thread_id&#x3D;2662386       exec_time&#x3D;0     error_code&#x3D;0</span><br><span class="line">SET TIMESTAMP&#x3D;1479845820&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.pseudo_thread_id&#x3D;2662386&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.foreign_key_checks&#x3D;1, @@session.sql_auto_is_null&#x3D;0, @@session.unique_checks&#x3D;1, @@session.autocommit&#x3D;1&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.sql_mode&#x3D;1075838976&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.auto_increment_increment&#x3D;1, @@session.auto_increment_offset&#x3D;1&#x2F;*!*&#x2F;;</span><br><span class="line">&#x2F;*!\C utf8mb4 *&#x2F;&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.character_set_client&#x3D;45,@@session.collation_connection&#x3D;45,@@session.collation_server&#x3D;224&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.lc_time_names&#x3D;0&#x2F;*!*&#x2F;;</span><br><span class="line">SET @@session.collation_database&#x3D;DEFAULT&#x2F;*!*&#x2F;;</span><br><span class="line">BEGIN</span><br><span class="line">&#x2F;*!*&#x2F;;</span><br><span class="line"># at 353</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 450 CRC32 0xb1d11f47  Table_map: &#96;linahr&#96;.&#96;qrtz_fired_triggers&#96; mapped to number 877</span><br><span class="line"># at 450</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 825 CRC32 0x0d1392a7  Update_rows: table id 877 flags: STMT_END_F</span><br><span class="line"></span><br><span class="line">BINLOG &#39;</span><br><span class="line">vKc0WBMBAAAAYQAAAMIBAAAAAG0DAAAAAAEABmxpbmFocgATcXJ0el9maXJlZF90cmlnZ2VycwAN</span><br><span class="line">Dw8PDw8ICAMPDw8PDxRoAR0BWAJYAlgCMABYAlgCAwADAAAeRx&#x2F;RsQ&#x3D;&#x3D;</span><br><span class="line">vKc0WB8BAAAAdwEAADkDAAAAAG0DAAAAAAEAAgAN&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;wDmDABDUk1zY2hlZHVsZXImADEyYzZl</span><br><span class="line">ZWNkMDgwZTE0Nzc1ODMzMjQ0ODYxNDc3NTgzMzc2NjQyGABxY2xvdWRWaWRlb1VwbG9hZFRyaWdn</span><br><span class="line">ZXIHAERFRkFVTFQZADEyYzZlZWNkMDgwZTE0Nzc1ODMzMjQ0ODZTEa+NWAEAAGA2r41YAQAAAAAA</span><br></pre></td></tr></table></figure>
<p>其中并没有出现我们想要的SQL语句。这时候就需要增加<code>-v</code>参数了。</p>
<p><code>-v</code>参数在手册中的描述如下：</p>
<blockquote>
<p>–verbose, -v</p>
<p>Reconstruct row events and display them as commented SQL statements. If this option is given twice, the output includes comments to indicate column data types and some metadata.</p>
<p>For examples that show the effect of –base64-output and –verbose on row event output, see the section called “MYSQLBINLOG ROW EVENT DISPLAY”.</p>
</blockquote>
<p>增加<code>-v</code>参数，可以看到如下的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">BINLOG &#39;</span><br><span class="line">vKc0WBMBAAAAXQAAAJYDAAAAAHQDAAAAAAMABmxpbmFocgANcXJ0el90cmlnZ2VycwAQDw8PDw8P</span><br><span class="line">CAgDDw8ICA8C&#x2F;BNoAVgCWAJYAlgC7gIwABgAWAIC4PGAPOuQ</span><br><span class="line">vKc0WB8BAAAAOwEAANEEAAAAAHQDAAAAAAEAAgAQ&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;yAgDABDUk1zY2hlZHVsZXIYAHFjbG91</span><br><span class="line">ZFZpZGVvVXBsb2FkVHJpZ2dlcgcAREVGQVVMVBcAcWNsb3VkVmlkZW9VcGxvYWREZXRhaWwHAERF</span><br><span class="line">RkFVTFRgNq+NWAEAAABMro1YAQAAAAAAAAhBQ1FVSVJFRARDUk9OeD&#x2F;UBlgBAAAAAAAAAAAAAAAA</span><br><span class="line">AAAgIAwAQ1JNc2NoZWR1bGVyGABxY2xvdWRWaWRlb1VwbG9hZFRyaWdnZXIHAERFRkFVTFQXAHFj</span><br><span class="line">bG91ZFZpZGVvVXBsb2FkRGV0YWlsBwBERUZBVUxUwCCwjVgBAABgNq+NWAEAAAAAAAAHV0FJVElO</span><br><span class="line">RwRDUk9OeD&#x2F;UBlgBAAAAAAAAAAAAAAAAAAAIicmV</span><br><span class="line">&#39;&#x2F;*!*&#x2F;;</span><br><span class="line">### UPDATE &#96;linahr&#96;.&#96;qrtz_triggers&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;&#39;CRMscheduler&#39;</span><br><span class="line">###   @2&#x3D;&#39;qcloudVideoUploadTrigger&#39;</span><br><span class="line">###   @3&#x3D;&#39;DEFAULT&#39;</span><br><span class="line">###   @4&#x3D;&#39;qcloudVideoUploadDetail&#39;</span><br><span class="line">###   @5&#x3D;&#39;DEFAULT&#39;</span><br><span class="line">###   @6&#x3D;NULL</span><br><span class="line">###   @7&#x3D;1479845820000</span><br><span class="line">###   @8&#x3D;1479845760000</span><br><span class="line">###   @9&#x3D;0</span><br><span class="line">###   @10&#x3D;&#39;ACQUIRED&#39;</span><br><span class="line">###   @11&#x3D;&#39;CRON&#39;</span><br><span class="line">###   @12&#x3D;1477583323000</span><br><span class="line">###   @13&#x3D;0</span><br><span class="line">###   @14&#x3D;NULL</span><br><span class="line">###   @15&#x3D;0</span><br><span class="line">###   @16&#x3D;&#39;&#39;</span><br><span class="line">### SET</span><br><span class="line">###   @1&#x3D;&#39;CRMscheduler&#39;</span><br><span class="line">###   @2&#x3D;&#39;qcloudVideoUploadTrigger&#39;</span><br><span class="line">###   @3&#x3D;&#39;DEFAULT&#39;</span><br><span class="line">###   @4&#x3D;&#39;qcloudVideoUploadDetail&#39;</span><br><span class="line">###   @5&#x3D;&#39;DEFAULT&#39;</span><br><span class="line">###   @6&#x3D;NULL</span><br><span class="line">###   @7&#x3D;1479845880000</span><br><span class="line">###   @8&#x3D;1479845820000</span><br><span class="line">###   @9&#x3D;0</span><br><span class="line">###   @10&#x3D;&#39;WAITING&#39;</span><br><span class="line">###   @11&#x3D;&#39;CRON&#39;</span><br><span class="line">###   @12&#x3D;1477583323000</span><br><span class="line">###   @13&#x3D;0</span><br><span class="line">###   @14&#x3D;NULL</span><br><span class="line">###   @15&#x3D;0</span><br><span class="line">###   @16&#x3D;&#39;&#39;</span><br><span class="line"># at 1233</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 1264 CRC32 0x484eacf5         Xid &#x3D; 447774161</span><br><span class="line">COMMIT&#x2F;*!*&#x2F;;</span><br><span class="line"># at 1264</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 1312 CRC32 0xc364953c         GTID [commit&#x3D;yes]</span><br><span class="line">SET @@SESSION.GTID_NEXT&#x3D; &#39;9dc1a422-aeb6-11e5-80cd-00163e001e5d:5846829&#39;&#x2F;*!*&#x2F;;</span><br><span class="line"># at 1312</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 1386 CRC32 0xbf84bd5c         Query   thread_id&#x3D;2662325       exec_time&#x3D;0     error_code&#x3D;0</span><br><span class="line">SET TIMESTAMP&#x3D;1479845820&#x2F;*!*&#x2F;;</span><br><span class="line">BEGIN</span><br><span class="line">&#x2F;*!*&#x2F;;</span><br><span class="line"># at 1386</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 1483 CRC32 0xb85e9cff         Table_map: &#96;linahr&#96;.&#96;qrtz_fired_triggers&#96; mapped to number 877</span><br><span class="line"># at 1483</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 1691 CRC32 0x1447d61d         Delete_rows: table id 877 flags: STMT_END_F</span><br></pre></td></tr></table></figure>
<p>增加<code>-vv</code>参数，还可以输出一些额外的数据类型信息。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">BINLOG &#39;</span><br><span class="line">vKc0WBMBAAAAYQAAAMIBAAAAAG0DAAAAAAEABmxpbmFocgATcXJ0el9maXJlZF90cmlnZ2VycwAN</span><br><span class="line">Dw8PDw8ICAMPDw8PDxRoAR0BWAJYAlgCMABYAlgCAwADAAAeRx&#x2F;RsQ&#x3D;&#x3D;</span><br><span class="line">vKc0WB8BAAAAdwEAADkDAAAAAG0DAAAAAAEAAgAN&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;wDmDABDUk1zY2hlZHVsZXImADEyYzZl</span><br><span class="line">ZWNkMDgwZTE0Nzc1ODMzMjQ0ODYxNDc3NTgzMzc2NjQyGABxY2xvdWRWaWRlb1VwbG9hZFRyaWdn</span><br><span class="line">ZXIHAERFRkFVTFQZADEyYzZlZWNkMDgwZTE0Nzc1ODMzMjQ0ODZTEa+NWAEAAGA2r41YAQAAAAAA</span><br><span class="line">AAhBQ1FVSVJFRAEwATAA4AwAQ1JNc2NoZWR1bGVyJgAxMmM2ZWVjZDA4MGUxNDc3NTgzMzI0NDg2</span><br><span class="line">MTQ3NzU4MzM3NjY0MhgAcWNsb3VkVmlkZW9VcGxvYWRUcmlnZ2VyBwBERUZBVUxUGQAxMmM2ZWVj</span><br><span class="line">ZDA4MGUxNDc3NTgzMzI0NDg2dTavjVgBAABgNq+NWAEAAAAAAAAJRVhFQ1VUSU5HFwBxY2xvdWRW</span><br><span class="line">aWRlb1VwbG9hZERldGFpbAcAREVGQVVMVAEwATCnkhMN</span><br><span class="line">&#39;&#x2F;*!*&#x2F;;</span><br><span class="line">### UPDATE &#96;linahr&#96;.&#96;qrtz_fired_triggers&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;&#39;CRMscheduler&#39; &#x2F;* VARSTRING(360) meta&#x3D;360 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;&#39;12c6eecd080e14775833244861477583376642&#39; &#x2F;* VARSTRING(285) meta&#x3D;285 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @3&#x3D;&#39;qcloudVideoUploadTrigger&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @4&#x3D;&#39;DEFAULT&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @5&#x3D;&#39;12c6eecd080e1477583324486&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @6&#x3D;1479845810515 &#x2F;* LONGINT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @7&#x3D;1479845820000 &#x2F;* LONGINT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @8&#x3D;0 &#x2F;* INT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @9&#x3D;&#39;ACQUIRED&#39; &#x2F;* VARSTRING(48) meta&#x3D;48 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @10&#x3D;NULL &#x2F;* VARSTRING(48) meta&#x3D;600 nullable&#x3D;1 is_null&#x3D;1 *&#x2F;</span><br><span class="line">###   @11&#x3D;NULL &#x2F;* VARSTRING(48) meta&#x3D;600 nullable&#x3D;1 is_null&#x3D;1 *&#x2F;</span><br><span class="line">###   @12&#x3D;&#39;0&#39; &#x2F;* VARSTRING(3) meta&#x3D;3 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @13&#x3D;&#39;0&#39; &#x2F;* VARSTRING(3) meta&#x3D;3 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">### SET</span><br><span class="line">###   @1&#x3D;&#39;CRMscheduler&#39; &#x2F;* VARSTRING(360) meta&#x3D;360 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;&#39;12c6eecd080e14775833244861477583376642&#39; &#x2F;* VARSTRING(285) meta&#x3D;285 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @3&#x3D;&#39;qcloudVideoUploadTrigger&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @4&#x3D;&#39;DEFAULT&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @5&#x3D;&#39;12c6eecd080e1477583324486&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @6&#x3D;1479845820021 &#x2F;* LONGINT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @7&#x3D;1479845820000 &#x2F;* LONGINT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @8&#x3D;0 &#x2F;* INT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @9&#x3D;&#39;EXECUTING&#39; &#x2F;* VARSTRING(48) meta&#x3D;48 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @10&#x3D;&#39;qcloudVideoUploadDetail&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @11&#x3D;&#39;DEFAULT&#39; &#x2F;* VARSTRING(600) meta&#x3D;600 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @12&#x3D;&#39;0&#39; &#x2F;* VARSTRING(3) meta&#x3D;3 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @13&#x3D;&#39;0&#39; &#x2F;* VARSTRING(3) meta&#x3D;3 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line"># at 825</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 918 CRC32 0x90eb3c80  Table_map: &#96;linahr&#96;.&#96;qrtz_triggers&#96; mapped to number 884</span><br><span class="line"># at 918</span><br><span class="line">#161123  4:17:00 server id 1  end_log_pos 1233 CRC32 0x95c98908         Update_rows: table id 884 flags: STMT_END_F</span><br></pre></td></tr></table></figure>

<h3 id="base64-output-DECODE-ROWS参数"><a href="#base64-output-DECODE-ROWS参数" class="headerlink" title="--base64-output=DECODE-ROWS参数"></a><code>--base64-output=DECODE-ROWS</code>参数</h3><p><code>--base64-decode</code>参数在手册上的说明如下：</p>
<blockquote>
<p>–base64-output=value</p>
<p>This option determines when events should be displayed encoded as base-64 strings using BINLOG statements. The option has these permissible values (not case sensitive):</p>
</blockquote>
<blockquote>
<p>·   AUTO (“automatic”) or UNSPEC (“unspecified”) displays BINLOG statements automatically when necessary (that is, for format description events and row events). If no –base64-output option is given, the effect is the same as –base64-output=AUTO.</p>
</blockquote>
<blockquote>
<pre><code>   Note
   Automatic BINLOG display is the only safe behavior if you intend to use the output of mysqlbinlog to re-execute binary log file contents. The other option values are intended only for debugging or testing purposes because they may produce output that does not include all events in executable form.
</code></pre>
</blockquote>
<blockquote>
<p>·   NEVER causes BINLOG statements not to be displayed.  mysqlbinlog exits with an error if a row event is found that must be displayed using BINLOG.</p>
</blockquote>
<blockquote>
<p>·   DECODE-ROWS specifies to mysqlbinlog that you intend for row events to be decoded and displayed as commented SQL statements by also specifying the –verbose option. Like NEVER, DECODE-ROWS suppresses display of BINLOG statements, but unlike NEVER, it does not exit with an error if a row event is found.</p>
</blockquote>
<blockquote>
<p>For examples that show the effect of –base64-output and –verbose on row event output, see the section called “MYSQLBINLOG ROW EVENT DISPLAY”.</p>
</blockquote>
<p>增加<code>--base64-output=DECODE-ROWS</code>参数执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --no-defaults -v --base64-output&#x3D;DECODE-ROWS mysql-bin.000858 &gt; tmp.txt</span><br></pre></td></tr></table></figure>
<p>输出如下，可以看到<code>BINLOG &#39;</code>开头，以base64编码的数据没有了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SET TIMESTAMP&#x3D;1479845826&#x2F;*!*&#x2F;;</span><br><span class="line">BEGIN</span><br><span class="line">&#x2F;*!*&#x2F;;</span><br><span class="line"># at 2697</span><br><span class="line">#161123  4:17:06 server id 1  end_log_pos 2773 CRC32 0x3b984e8d         Table_map: &#96;linahr_pay&#96;.&#96;qrtz_scheduler_state&#96; mapped to number 1180</span><br><span class="line"># at 2773</span><br><span class="line">#161123  4:17:06 server id 1  end_log_pos 2925 CRC32 0x394f0f8b         Update_rows: table id 1180 flags: STMT_END_F</span><br><span class="line">### UPDATE &#96;linahr_pay&#96;.&#96;qrtz_scheduler_state&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;&#39;CRMscheduler&#39;</span><br><span class="line">###   @2&#x3D;&#39;f5589e5e5a731477582086079&#39;</span><br><span class="line">###   @3&#x3D;1479845806492</span><br><span class="line">###   @4&#x3D;20000</span><br><span class="line">### SET</span><br><span class="line">###   @1&#x3D;&#39;CRMscheduler&#39;</span><br><span class="line">###   @2&#x3D;&#39;f5589e5e5a731477582086079&#39;</span><br><span class="line">###   @3&#x3D;1479845826494</span><br><span class="line">###   @4&#x3D;20000</span><br><span class="line"># at 2925</span><br><span class="line">#161123  4:17:06 server id 1  end_log_pos 2956 CRC32 0x7d1d1eab         Xid &#x3D; 447774290</span><br><span class="line">COMMIT&#x2F;*!*&#x2F;;</span><br></pre></td></tr></table></figure>

<h3 id="skip-gtids参数"><a href="#skip-gtids参数" class="headerlink" title="--skip-gtids参数"></a><code>--skip-gtids</code>参数</h3><blockquote>
<p>–skip-gtids[=(true|false)]</p>
</blockquote>
<blockquote>
<p>Do not display any GTIDs in the output. This is needed when writing to a dump file from one or more binary logs containing GTIDs, as shown in this example:</p>
</blockquote>
<blockquote>
<pre><code>   shell&gt; mysqlbinlog --skip-gtids binlog.000001 &gt;  /tmp/dump.sql
   shell&gt; mysqlbinlog --skip-gtids binlog.000002 &gt;&gt; /tmp/dump.sql
   shell&gt; mysql -u root -p -e &quot;source /tmp/dump.sql&quot;
</code></pre>
</blockquote>
<blockquote>
<p>The use of this option is otherwise not normally recommended in production.</p>
</blockquote>
<h2 id="最终命令"><a href="#最终命令" class="headerlink" title="最终命令"></a>最终命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --no-defaults -v --base64-output=DECODE-ROWS --skip-gtids mysql-bin.000858</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2016-10-31-read-mysql-binlog-as-sql/" data-id="cklf7tstx0037z8t48n7e8h2i" data-title="以SQL方式读取MySQL的GTID格式Binlog" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Binlog/" rel="tag">Binlog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GTID/" rel="tag">GTID</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2017-03-02-spring-framework-architecture" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/21/2017-03-02-spring-framework-architecture/" class="article-date">
  <time class="dt-published" datetime="2021-02-21T13:57:19.813Z" itemprop="datePublished">2021-02-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Spring/">Spring</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/21/2017-03-02-spring-framework-architecture/">Spring Framework的整体架构</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Spring Framework 作为一个优秀的开源框架，是为了解决企业应用程序开发复杂性而创建的。框架的主要优势之一就是其分层架构，分层架构允许您选择使用哪一个组件，同时为J2EE应用程序开发提供集成的框架。</p>
<h2 id="Spring-Framework的整体架构"><a href="#Spring-Framework的整体架构" class="headerlink" title="Spring Framework的整体架构"></a>Spring Framework的整体架构</h2><p>Spring Framework总共有十几个组件，其中核心组件只有三个：Core、Context和Beans。</p>
<h3 id="Spring-Framework-3-x-的总体架构图"><a href="#Spring-Framework-3-x-的总体架构图" class="headerlink" title="Spring Framework 3.x 的总体架构图"></a>Spring Framework 3.x 的总体架构图</h3><p><img src="/upload/images/14.png" alt="Spring 3.x总体架构图"></p>
<p>组成 Spring Framework的每个模块（或组件）都可以单独存在，或者与其他一个或多个模块联合实现。每个模块的功能如下：</p>
<ul>
<li><p><strong>Spring Core（核心容器）：</strong> 核心容器提供 Spring 框架的基本功能。核心容器的主要组件是 BeanFactory，它是工厂模式的实现。BeanFactory 使用控制反转（IOC）模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。</p>
</li>
<li><p><strong>Spring Context（上下文）：</strong> Spring 上下文是一个配置文件，向 Spring 框架提供上下文信息。Spring 上下文包括企业服务，例如：JNDI、EJB、电子邮件、国际化、校验和调度功能。</p>
</li>
<li><p><strong>Spring AOP：</strong> 通过配置管理特性，Spring AOP 模块直接将面向方面的编程功能集成到了 Spring 框架中。所以，可以很容易地使 Spring 框架管理的任何对象支持 AOP。Spring AOP 模块为基于 Spring 的应用程序中的对象提供了事务管理服务。通过使用 Spring AOP，不用依赖 EJB 组件，就可以将声明性事务管理集成到应用程序中。</p>
</li>
<li><p><strong>Spring DAO：</strong> JDBC DAO 抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库供应商抛出的错误消息。异常层次结构简化了错误处理，并且极大地降低了需要编写的异常代码数量（例如打开和关闭连接）。Spring DAO 的面向 JDBC 的异常遵从通用的 DAO 异常层次结构。</p>
</li>
<li><p><strong>Spring ORM：</strong> Spring 框架插入了若干个 ORM 框架，从而提供了 ORM 的对象关系工具，其中包括 JDO、Hibernate 和 iBatis SQL Map。所有这些都遵从 Spring 的通用事务和 DAO 异常层次结构。</p>
</li>
<li><p><strong>Spring Web 模块：</strong> Web 上下文模块建立在应用程序上下文模块之上，为基于 Web 的应用程序提供了上下文。所以，Spring 框架支持与 Jakarta Struts 的集成。Web 模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。</p>
</li>
<li><p><strong>Spring MVC 框架：</strong> MVC 框架是一个全功能的构建 Web 应用程序的 MVC 实现。通过策略接口，MVC 框架变成为高度可配置的，MVC 容纳了大量视图技术，其中包括 JSP、Velocity、Tiles、iText 和 POI。</p>
</li>
</ul>
<p>从图中可以看出，IOC 的实现包 spring-beans 和 AOP 的实现包 spring-aop 也是整个框架的基础，而 spring-core 是整个框架的核心，基础的功能都在这里。</p>
<p>在此基础之上，spring-context 提供上下文环境，为各个模块提供粘合作用。</p>
<p>在 spring-context 基础之上提供了 spring-tx 和 spring-orm包，而web部分的功能，都是要依赖spring-web来实现的。</p>
<h3 id="Spring-Framework-4-x-的系统架构图"><a href="#Spring-Framework-4-x-的系统架构图" class="headerlink" title="Spring Framework 4.x 的系统架构图"></a>Spring Framework 4.x 的系统架构图</h3><p><img src="/upload/images/15.png" alt="Spring Framework 4.x 的系统架构图"></p>
<p><strong>Spring Framework 4.x对比Spring Framework 3.2.x的系统架构变化：</strong></p>
<ol>
<li><p>Spring 4.0.3去掉了 struts 模块(spring-struts包)</p>
<p>现在的 Spring mvc的确已经足够优秀了，大量的 web 应用均已经使用了 Spring mvc。而 struts1.x 的架构太落后了，struts2.x 是 struts 自身提供了和 Spring 的集成包，但是由于之前版本的 struts2 存在很多致命的安全漏洞，所以，大大影响了其使用度，好在最新的2.3.16版本的 struts 安全有所改善，希望不会再出什么大乱子。</p>
</li>
<li><p>增加 WebSocket 模块(spring-websocket包)</p>
<p>增加了对 WebSocket、SockJS 以及 STOMP 的支持，它与 JSR-356 Java WebSocket API 兼容。另外，还提供了基于 SockJS（对 WebSocket 的模拟）的回调方案，以适应不支持 WebSocket 协议的浏览器。</p>
</li>
<li><p>增加了 messaging 模块(spring-messaging)</p>
<p>提供了对 STOMP 的支持，以及用于路由和处理来自 WebSocket 客户端的 STOMP 消息的注解编程模型。spring-messaging 模块中还 包含了 Spring Integration 项目中的核心抽象类，如 Message、MessageChannel、MessageHandler。</p>
</li>
<li><p>加强了 beans 模块，增加spring-beans-groovy</p>
<p>应用可以部分或完全使用 Groovy 编写。借助于 Spring 4.0，能够使用 Groovy DSL 定义外部的 Bean 配置，这类似于 XML Bean 声明，但是语法更为简洁。使用Groovy还能够在启动代码中直接嵌入Bean的声明。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/21/2017-03-02-spring-framework-architecture/" data-id="cklf7tsty003bz8t4eco84xlz" data-title="Spring Framework的整体架构" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Microservice/">Microservice</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Microservice/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%9C%8D%E5%8A%A1%E5%99%A8/">Web服务器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/">分布式系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E5%8D%93/">安卓</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BF%90%E7%BB%B4/">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Service/" rel="tag">Android Service</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bash/" rel="tag">Bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binlog/" rel="tag">Binlog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Browser-Caching/" rel="tag">Browser Caching</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CPU/" rel="tag">CPU</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cobar/" rel="tag">Cobar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECS/" rel="tag">ECS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Email/" rel="tag">Email</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emoji/" rel="tag">Emoji</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GTID/" rel="tag">GTID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Goaccess/" rel="tag">Goaccess</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gzip/" rel="tag">Gzip</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/" rel="tag">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Introduction-to-Microservices/" rel="tag">Introduction to Microservices</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK/" rel="tag">JDK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JUnit/" rel="tag">JUnit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Mail/" rel="tag">Java Mail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaMail/" rel="tag">JavaMail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jedis/" rel="tag">Jedis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Marathon/" rel="tag">Marathon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mesos/" rel="tag">Mesos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mockito/" rel="tag">Mockito</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Moint/" rel="tag">Moint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mongo/" rel="tag">Mongo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyCAT/" rel="tag">MyCAT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/" rel="tag">Nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORM/" rel="tag">ORM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PowerMock/" rel="tag">PowerMock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMTP/" rel="tag">SMTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Script/" rel="tag">Script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shell/" rel="tag">Shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/" rel="tag">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Data-JPA/" rel="tag">Spring Data JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Modules/" rel="tag">Spring Modules</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Telnet/" rel="tag">Telnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tuning/" rel="tag">Tuning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/USB/" rel="tag">USB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim/" rel="tag">Vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Volumes/" rel="tag">Volumes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/" rel="tag">Zabbix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zookeeper/" rel="tag">Zookeeper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apk/" rel="tag">apk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emoji/" rel="tag">emoji</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/enca/" rel="tag">enca</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysqldump/" rel="tag">mysqldump</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swap/" rel="tag">swap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utf8mb4/" rel="tag">utf8mb4</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" rel="tag">中间件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" rel="tag">主从复制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" rel="tag">分布式锁</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" rel="tag">分库分表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" rel="tag">单元测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%8D%93/" rel="tag">安卓</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BA%8F%E5%8F%B7%E7%94%9F%E6%88%90%E5%99%A8/" rel="tag">序号生成器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag">微信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">微服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" rel="tag">电子书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7/" rel="tag">监控</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AD%BE%E5%90%8D/" rel="tag">签名</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E7%A0%81/" rel="tag">编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" rel="tag">读写分离</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AC%E8%BD%BD/" rel="tag">转载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" rel="tag">阿里云</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Android-Service/" style="font-size: 10px;">Android Service</a> <a href="/tags/Bash/" style="font-size: 10px;">Bash</a> <a href="/tags/Binlog/" style="font-size: 10px;">Binlog</a> <a href="/tags/Browser-Caching/" style="font-size: 10px;">Browser Caching</a> <a href="/tags/CPU/" style="font-size: 10px;">CPU</a> <a href="/tags/Cobar/" style="font-size: 10px;">Cobar</a> <a href="/tags/Docker/" style="font-size: 11.67px;">Docker</a> <a href="/tags/ECS/" style="font-size: 10px;">ECS</a> <a href="/tags/Email/" style="font-size: 10px;">Email</a> <a href="/tags/Emoji/" style="font-size: 10px;">Emoji</a> <a href="/tags/GTID/" style="font-size: 11.67px;">GTID</a> <a href="/tags/Goaccess/" style="font-size: 10px;">Goaccess</a> <a href="/tags/Gzip/" style="font-size: 10px;">Gzip</a> <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/Introduction-to-Microservices/" style="font-size: 10px;">Introduction to Microservices</a> <a href="/tags/JDK/" style="font-size: 11.67px;">JDK</a> <a href="/tags/JUnit/" style="font-size: 10px;">JUnit</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 11.67px;">Java</a> <a href="/tags/Java-Mail/" style="font-size: 10px;">Java Mail</a> <a href="/tags/JavaMail/" style="font-size: 10px;">JavaMail</a> <a href="/tags/Jedis/" style="font-size: 10px;">Jedis</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Marathon/" style="font-size: 10px;">Marathon</a> <a href="/tags/Mesos/" style="font-size: 10px;">Mesos</a> <a href="/tags/Mockito/" style="font-size: 10px;">Mockito</a> <a href="/tags/Moint/" style="font-size: 10px;">Moint</a> <a href="/tags/Mongo/" style="font-size: 10px;">Mongo</a> <a href="/tags/MyCAT/" style="font-size: 11.67px;">MyCAT</a> <a href="/tags/MySQL/" style="font-size: 20px;">MySQL</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Nodejs/" style="font-size: 10px;">Nodejs</a> <a href="/tags/ORM/" style="font-size: 10px;">ORM</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/Performance/" style="font-size: 11.67px;">Performance</a> <a href="/tags/PowerMock/" style="font-size: 10px;">PowerMock</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/SMTP/" style="font-size: 10px;">SMTP</a> <a href="/tags/Script/" style="font-size: 10px;">Script</a> <a href="/tags/Shell/" style="font-size: 11.67px;">Shell</a> <a href="/tags/Spring/" style="font-size: 16.67px;">Spring</a> <a href="/tags/Spring-Cloud/" style="font-size: 11.67px;">Spring Cloud</a> <a href="/tags/Spring-Data-JPA/" style="font-size: 10px;">Spring Data JPA</a> <a href="/tags/Spring-Modules/" style="font-size: 10px;">Spring Modules</a> <a href="/tags/Telnet/" style="font-size: 10px;">Telnet</a> <a href="/tags/Tuning/" style="font-size: 10px;">Tuning</a> <a href="/tags/USB/" style="font-size: 10px;">USB</a> <a href="/tags/Ubuntu/" style="font-size: 11.67px;">Ubuntu</a> <a href="/tags/Vim/" style="font-size: 10px;">Vim</a> <a href="/tags/Volumes/" style="font-size: 10px;">Volumes</a> <a href="/tags/Zabbix/" style="font-size: 11.67px;">Zabbix</a> <a href="/tags/Zookeeper/" style="font-size: 10px;">Zookeeper</a> <a href="/tags/apk/" style="font-size: 10px;">apk</a> <a href="/tags/emoji/" style="font-size: 10px;">emoji</a> <a href="/tags/enca/" style="font-size: 10px;">enca</a> <a href="/tags/mysqldump/" style="font-size: 11.67px;">mysqldump</a> <a href="/tags/swap/" style="font-size: 10px;">swap</a> <a href="/tags/utf8mb4/" style="font-size: 11.67px;">utf8mb4</a> <a href="/tags/vim/" style="font-size: 10px;">vim</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 10px;">中间件</a> <a href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" style="font-size: 10px;">主从复制</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 10px;">分布式锁</a> <a href="/tags/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/" style="font-size: 10px;">分库分表</a> <a href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">单元测试</a> <a href="/tags/%E5%AE%89%E5%8D%93/" style="font-size: 13.33px;">安卓</a> <a href="/tags/%E5%BA%8F%E5%8F%B7%E7%94%9F%E6%88%90%E5%99%A8/" style="font-size: 10px;">序号生成器</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size: 10px;">微信</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 11.67px;">微服务</a> <a href="/tags/%E7%94%B5%E5%AD%90%E4%B9%A6/" style="font-size: 10px;">电子书</a> <a href="/tags/%E7%9B%91%E6%8E%A7/" style="font-size: 15px;">监控</a> <a href="/tags/%E7%AD%BE%E5%90%8D/" style="font-size: 10px;">签名</a> <a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size: 11.67px;">编码</a> <a href="/tags/%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB/" style="font-size: 10px;">读写分离</a> <a href="/tags/%E8%BD%AC%E8%BD%BD/" style="font-size: 18.33px;">转载</a> <a href="/tags/%E9%98%BF%E9%87%8C%E4%BA%91/" style="font-size: 10px;">阿里云</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/02/21/2016-08-24-import-data-into-mycat/">将现有数据库的数据导入MyCAT</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-06-15-login-smtp-with-telnet/">利用telnet进行SMTP的验证</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-06-27-monitor-mysql-with-zabbix/">使用Zabbix监控MySQL服务器</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-07-19-mongo-queries/">Mongo常用命令</a>
          </li>
        
          <li>
            <a href="/2021/02/21/2016-07-19-vim-commands/">Vim常用命令</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>